# 🚀 AI风水网站生产部署清单

> **部署时间**: 预计15-30分钟  
> **难度级别**: ⭐⭐☆☆☆ (中等)

---

## ✅ **部署前检查清单**

### 📋 **必备条件**
- [ ] Node.js 16.0.0+ 已安装
- [ ] DeepSeek API密钥已获取
- [ ] 服务器/云主机已准备 (最低1GB内存)
- [ ] 域名已配置 (可选)

### 🔧 **环境准备**
- [ ] 防火墙开放3000端口
- [ ] SSL证书配置 (生产环境推荐)
- [ ] 备份计划已制定

---

## 🎯 **快速部署步骤**

### 1️⃣ **代码部署**
```bash
# 克隆/上传项目文件到服务器
cd /path/to/your/project

# 安装生产依赖
npm install --production

# 复制环境配置
cp example.env .env
```

### 2️⃣ **配置API密钥**
```bash
# 编辑环境变量文件
nano .env

# 设置以下内容：
DEEPSEEK_API_KEY=你的真实API密钥
DEEPSEEK_BASE_URL=https://api.deepseek.com
PORT=3000
NODE_ENV=production
```

### 3️⃣ **启动服务**
```bash
# 测试启动
npm start

# 生产启动 (推荐使用PM2)
npm install -g pm2
pm2 start server.js --name "fengshui-website"
pm2 save
pm2 startup
```

### 4️⃣ **验证部署**
```bash
# 健康检查
curl http://localhost:3000/api/health

# 预期响应：
{
  "status": "healthy",
  "config": {
    "hasApiKey": true,
    "defaultModel": "deepseek-reasoner"
  }
}
```

---

## 🔧 **生产环境优化**

### ⚡ **性能优化**
```bash
# 1. 配置反向代理 (Nginx示例)
sudo nano /etc/nginx/sites-available/fengshui

# 内容示例：
server {
    listen 80;
    server_name yourdomain.com;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}

# 2. 启用配置
sudo ln -s /etc/nginx/sites-available/fengshui /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 🛡️ **安全加固**
```bash
# 1. 设置文件权限
chmod 755 server.js
chmod 600 .env

# 2. 创建专用用户 (推荐)
sudo useradd -r -s /bin/false fengshui-user
sudo chown -R fengshui-user:fengshui-user /path/to/project

# 3. 配置防火墙
sudo ufw allow 22    # SSH
sudo ufw allow 80    # HTTP
sudo ufw allow 443   # HTTPS
sudo ufw enable
```

---

## 📊 **监控配置**

### 🔍 **健康监控**
```bash
# 创建监控脚本
cat > monitor.sh << 'EOF'
#!/bin/bash
HEALTH_URL="http://localhost:3000/api/health"
RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" $HEALTH_URL)

if [ $RESPONSE != "200" ]; then
    echo "Service down, restarting..."
    pm2 restart fengshui-website
    # 可添加告警通知
fi
EOF

chmod +x monitor.sh

# 添加到crontab (每5分钟检查)
echo "*/5 * * * * /path/to/monitor.sh" | crontab -
```

### 📈 **日志配置**
```bash
# PM2日志管理
pm2 logs fengshui-website     # 查看日志
pm2 flush                     # 清空日志
pm2 install pm2-logrotate     # 日志轮转
```

---

## 🚨 **故障排除**

### ❌ **常见问题**

#### 问题1: 端口占用
```bash
# 检查端口占用
netstat -tulpn | grep :3000

# 释放端口
sudo kill -9 <PID>
```

#### 问题2: API密钥错误
```bash
# 验证API密钥
curl -H "Authorization: Bearer YOUR_API_KEY" \
     https://api.deepseek.com/v1/models
```

#### 问题3: 权限错误
```bash
# 检查文件权限
ls -la server.js .env
sudo chown $USER:$USER server.js .env
```

#### 问题4: 依赖问题
```bash
# 清理重装
rm -rf node_modules package-lock.json
npm install
```

---

## 📱 **移动端测试**

### 🔍 **测试清单**
- [ ] iPhone Safari 测试
- [ ] Android Chrome 测试
- [ ] 微信浏览器测试
- [ ] 响应式布局检查
- [ ] 触摸操作验证

---

## 🎯 **部署完成检查**

### ✅ **功能验证**
- [ ] 网站首页正常加载
- [ ] API健康检查通过
- [ ] 图片上传功能正常
- [ ] AI分析功能正常
- [ ] 多语言切换正常
- [ ] 移动端适配正常

### 📈 **性能验证**
- [ ] 页面加载 < 3秒
- [ ] API响应正常
- [ ] 文件上传正常
- [ ] 错误处理正常

### 🔒 **安全验证**
- [ ] 文件上传限制生效
- [ ] 错误信息不泄露敏感信息
- [ ] HTTPS配置正确 (如适用)

---

## 📞 **支持联系**

### 🆘 **技术支持**
- **开发者**: gonetguo-max
- **文档**: 项目目录下完整文档
- **测试**: test-functionality.js
- **日志**: PM2日志系统

### 🎉 **部署成功！**
🌟 恭喜！您的AI风水网站已成功部署到生产环境！

---

**📝 备注**: 建议定期备份数据和更新依赖包以确保安全性 