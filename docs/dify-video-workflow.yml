name: "AIé£æ°´åˆ†æè§†é¢‘è‡ªåŠ¨ç”Ÿæˆå™¨"
description: "åŸºäºAIé£æ°´åˆ†æç»“æœè‡ªåŠ¨ç”ŸæˆçŸ­è§†é¢‘å†…å®¹ï¼Œæ”¯æŒå¤šå¹³å°å‘å¸ƒ"
version: "1.0"
category: "content_creation"

# Difyå·¥ä½œæµé…ç½®
workflow:
  # è¾“å…¥å˜é‡å®šä¹‰
  inputs:
    feng_shui_analysis:
      type: "object"
      description: "é£æ°´åˆ†æç»“æœæ•°æ®"
      required: true
      properties:
        score:
          type: "number"
          description: "é£æ°´è¯„åˆ† (0-100)"
        level:
          type: "string"
          description: "é£æ°´ç­‰çº§"
        summary:
          type: "string"
          description: "åˆ†ææ‘˜è¦"
        suggestions:
          type: "array"
          description: "æ”¹å–„å»ºè®®åˆ—è¡¨"
        room_type:
          type: "string"
          description: "æˆ¿é—´ç±»å‹"
        direction:
          type: "string"
          description: "æˆ¿å±‹æœå‘"
        areas:
          type: "object"
          description: "å…­åŒºåŸŸè¯¦ç»†åˆ†æ"
    
    video_style:
      type: "string"
      description: "è§†é¢‘é£æ ¼"
      default: "professional"
      options: ["professional", "casual", "trendy"]
    
    target_platforms:
      type: "array"
      description: "ç›®æ ‡å‘å¸ƒå¹³å°"
      default: ["douyin", "xiaohongshu", "kuaishou"]

  # å·¥ä½œæµèŠ‚ç‚¹
  nodes:
    # 1. å¼€å§‹èŠ‚ç‚¹
    start:
      type: "start"
      id: "start_node"
      outputs:
        - "feng_shui_analysis"
        - "video_style" 
        - "target_platforms"

    # 2. å†…å®¹ç­–ç•¥åˆ†æå™¨
    content_strategy_analyzer:
      type: "llm"
      id: "content_analyzer"
      depends_on: ["start"]
      config:
        model: "gpt-4"
        temperature: 0.7
        max_tokens: 1200
        system_prompt: |
          ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„çŸ­è§†é¢‘å†…å®¹ç­–ç•¥ä¸“å®¶ï¼Œæ“…é•¿é£æ°´é¢†åŸŸçš„å†…å®¹åˆ›ä½œã€‚
          ä½ éœ€è¦æ ¹æ®é£æ°´åˆ†æç»“æœï¼Œåˆ¶å®šé€‚åˆä¸åŒå¹³å°çš„å†…å®¹ç­–ç•¥ã€‚
          
          ä½ çš„ä»»åŠ¡æ˜¯ï¼š
          1. åˆ†æé£æ°´æ•°æ®çš„äº®ç‚¹å’Œç—›ç‚¹
          2. ç¡®å®šæœ€ä½³çš„å†…å®¹è§’åº¦
          3. è®¾è®¡å¸å¼•äººçš„æ ‡é¢˜
          4. è§„åˆ’60ç§’è§†é¢‘çš„ç»“æ„
        
        user_prompt: |
          è¯·åŸºäºä»¥ä¸‹é£æ°´åˆ†æç»“æœï¼Œè®¾è®¡ä¸€ä¸ª60ç§’çŸ­è§†é¢‘çš„å†…å®¹ç­–ç•¥ï¼š
          
          ## é£æ°´åˆ†ææ•°æ®
          {{feng_shui_analysis}}
          
          ## è§†é¢‘é£æ ¼åå¥½
          {{video_style}}
          
          ## ç›®æ ‡å¹³å°
          {{target_platforms}}
          
          è¯·è¾“å‡ºä»¥ä¸‹å†…å®¹ï¼š
          
          ### 1. å†…å®¹è§’åº¦åˆ†æ
          - ä¸»è¦å–ç‚¹ï¼šï¼ˆæœ€å¸å¼•äººçš„ç‚¹ï¼‰
          - ç›®æ ‡å—ä¼—ï¼šï¼ˆè°ä¼šå¯¹è¿™ä¸ªå†…å®¹æ„Ÿå…´è¶£ï¼‰
          - æƒ…ç»ªå®šä½ï¼šï¼ˆç§¯æ/ä¸­æ€§/è­¦ç¤ºï¼‰
          
          ### 2. è§†é¢‘æ ‡é¢˜å»ºè®®
          - æŠ–éŸ³ç‰ˆæ ‡é¢˜ï¼šï¼ˆå¸å¼•çœ¼çƒï¼Œå¸¦è¯é¢˜æ€§ï¼‰
          - å°çº¢ä¹¦æ ‡é¢˜ï¼šï¼ˆå®ç”¨å¯¼å‘ï¼Œå¸¦ç¾å­¦æ„Ÿï¼‰
          - å¿«æ‰‹ç‰ˆæ ‡é¢˜ï¼šï¼ˆæ¥åœ°æ°”ï¼Œå¼ºè°ƒä»·å€¼ï¼‰
          
          ### 3. è§†é¢‘ç»“æ„è§„åˆ’
          - å¼€åœº (0-5ç§’)ï¼šå¦‚ä½•æŠ“ä½æ³¨æ„åŠ›
          - ä¸»ä½“ (5-50ç§’)ï¼šæ ¸å¿ƒå†…å®¹å±•ç¤º
          - ç»“å°¾ (50-60ç§’)ï¼šè¡ŒåŠ¨å·å¬
          
          ### 4. å…³é”®ä¿¡æ¯æå–
          - æ ¸å¿ƒè¯„åˆ†ï¼š{{feng_shui_analysis.score}}åˆ†
          - ä¸»è¦é—®é¢˜ï¼šåˆ—å‡º1-2ä¸ªå…³é”®é—®é¢˜
          - è§£å†³æ–¹æ¡ˆï¼šå¯¹åº”çš„æ”¹å–„å»ºè®®
          - é¢„æœŸæ•ˆæœï¼šæ”¹å–„åçš„ç§¯æå˜åŒ–

    # 3. è„šæœ¬ç”Ÿæˆå™¨
    script_generator:
      type: "llm"
      id: "script_writer"
      depends_on: ["content_analyzer"]
      config:
        model: "gpt-4"
        temperature: 0.8
        max_tokens: 1500
        system_prompt: |
          ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„çŸ­è§†é¢‘è„šæœ¬ç¼–å‰§ï¼Œä¸“é—¨åˆ›ä½œé£æ°´å†…å®¹ã€‚
          ä½ éœ€è¦å°†å†…å®¹ç­–ç•¥è½¬åŒ–ä¸ºå…·ä½“çš„è§†é¢‘è„šæœ¬ã€‚
          
          è„šæœ¬è¦æ±‚ï¼š
          - è¯­è¨€ç”ŸåŠ¨ï¼Œæ˜“äºç†è§£
          - èŠ‚å¥ç´§å‡‘ï¼Œä¿¡æ¯å¯†åº¦é«˜
          - åŒ…å«äº’åŠ¨å…ƒç´ 
          - é€‚åˆé…éŸ³å’Œå­—å¹•
        
        user_prompt: |
          åŸºäºä»¥ä¸‹å†…å®¹ç­–ç•¥ï¼Œåˆ›ä½œä¸€ä¸ª60ç§’çš„è§†é¢‘è„šæœ¬ï¼š
          
          ## å†…å®¹ç­–ç•¥
          {{content_analyzer.output}}
          
          ## åŸå§‹æ•°æ®
          {{feng_shui_analysis}}
          
          è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡ºè„šæœ¬ï¼š
          
          ### è§†é¢‘è„šæœ¬
          
          **å¼€åœº (0-5ç§’)**
          [ç”»é¢æè¿°] 
          [æ—ç™½å†…å®¹]
          [å­—å¹•æ–‡å­—]
          
          **ä¸»ä½“éƒ¨åˆ† (5-50ç§’)**
          [ç”»é¢æè¿°]
          [æ—ç™½å†…å®¹] 
          [å­—å¹•æ–‡å­—]
          [äº’åŠ¨æç¤º]
          
          **ç»“å°¾ (50-60ç§’)**
          [ç”»é¢æè¿°]
          [æ—ç™½å†…å®¹]
          [å­—å¹•æ–‡å­—]
          [è¡ŒåŠ¨å·å¬]
          
          ### é…å¥—è¦ç´ 
          - èƒŒæ™¯éŸ³ä¹é£æ ¼ï¼š
          - ç”»é¢è½¬åœºæ•ˆæœï¼š
          - é‡ç‚¹æ ‡æ³¨æ–‡å­—ï¼š
          - äº’åŠ¨é—®é¢˜è®¾è®¡ï¼š
          
          ### å¹³å°é€‚é…å»ºè®®
          - æŠ–éŸ³ç‰ˆé‡ç‚¹ï¼š
          - å°çº¢ä¹¦ç‰ˆé‡ç‚¹ï¼š
          - å¿«æ‰‹ç‰ˆé‡ç‚¹ï¼š

    # 4. è§†è§‰è®¾è®¡ç”Ÿæˆå™¨
    visual_design_generator:
      type: "llm"
      id: "visual_designer"
      depends_on: ["script_writer"]
      config:
        model: "gpt-4"
        temperature: 0.9
        max_tokens: 1000
        system_prompt: |
          ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„è§†è§‰è®¾è®¡å¸ˆï¼Œä¸“é—¨ä¸ºé£æ°´çŸ­è§†é¢‘è®¾è®¡è§†è§‰æ–¹æ¡ˆã€‚
          ä½ éœ€è¦æ ¹æ®è„šæœ¬å†…å®¹ï¼Œè®¾è®¡è¯¦ç»†çš„è§†è§‰å‘ˆç°æ–¹æ¡ˆã€‚
        
        user_prompt: |
          åŸºäºä»¥ä¸‹è§†é¢‘è„šæœ¬ï¼Œè®¾è®¡è§†è§‰å‘ˆç°æ–¹æ¡ˆï¼š
          
          ## è§†é¢‘è„šæœ¬
          {{script_writer.output}}
          
          ## é£æ°´æ•°æ®
          è¯„åˆ†ï¼š{{feng_shui_analysis.score}}åˆ†
          ç­‰çº§ï¼š{{feng_shui_analysis.level}}
          æˆ¿å‹ï¼š{{feng_shui_analysis.room_type}}
          æœå‘ï¼š{{feng_shui_analysis.direction}}
          
          è¯·è®¾è®¡ä»¥ä¸‹è§†è§‰å…ƒç´ ï¼š
          
          ### 1. è‰²å½©æ–¹æ¡ˆ
          - ä¸»è‰²è°ƒï¼šï¼ˆåŸºäºé£æ°´è¯„åˆ†é€‰æ‹©ï¼‰
          - è¾…åŠ©è‰²ï¼š
          - èƒŒæ™¯è‰²ï¼š
          
          ### 2. ç”»é¢æ„å›¾
          - å¼€åœºç”»é¢è®¾è®¡
          - ä¸»ä½“å†…å®¹å¸ƒå±€
          - ä¿¡æ¯å±•ç¤ºæ–¹å¼
          
          ### 3. åŠ¨ç”»æ•ˆæœ
          - æ–‡å­—å‡ºç°æ–¹å¼
          - å›¾è¡¨åŠ¨ç”»æ•ˆæœ
          - è½¬åœºåŠ¨ç”»å»ºè®®
          
          ### 4. å­—ä½“ä¸æ’ç‰ˆ
          - æ ‡é¢˜å­—ä½“
          - æ­£æ–‡å­—ä½“
          - å¼ºè°ƒæ–‡å­—æ ·å¼
          
          ### 5. å›¾æ ‡ç¬¦å·
          - é£æ°´ç›¸å…³å›¾æ ‡
          - è¯„åˆ†å±•ç¤ºå›¾å½¢
          - æ–¹å‘æŒ‡ç¤ºç¬¦å·

    # 5. AIå›¾åƒæç¤ºè¯ç”Ÿæˆå™¨
    image_prompt_generator:
      type: "code"
      id: "image_prompts"
      depends_on: ["visual_designer"]
      config:
        language: "python"
        code: |
          import json
          import re
          
          def generate_image_prompts(visual_design, feng_shui_data, script_content):
              """ç”ŸæˆAIå›¾åƒçš„è¯¦ç»†æç¤ºè¯"""
              
              # æå–å…³é”®ä¿¡æ¯
              score = feng_shui_data.get('score', 70)
              level = feng_shui_data.get('level', 'ä¸­ç­‰')
              room_type = feng_shui_data.get('room_type', 'ä½å®…')
              direction = feng_shui_data.get('direction', 'å—')
              
              # æ ¹æ®è¯„åˆ†ç¡®å®šè§†è§‰é£æ ¼
              if score >= 80:
                  mood = "bright, prosperous, golden light, harmonious"
                  energy = "positive, flowing, abundant"
              elif score >= 60:
                  mood = "balanced, natural, soft lighting, peaceful"
                  energy = "stable, gentle, harmonious"
              else:
                  mood = "needs improvement, hope, transformation, gentle"
                  energy = "potential, growth, positive change"
              
              # ç”Ÿæˆå„ç±»å›¾åƒæç¤ºè¯
              prompts = {
                  "background_main": {
                      "prompt": f"Modern Chinese feng shui {room_type} interior, {mood}, cinematic lighting, professional photography, 4K quality, feng shui principles, {energy} energy flow",
                      "style": "realistic, professional, architectural photography",
                      "aspect_ratio": "9:16",
                      "usage": "main_background"
                  },
                  
                  "feng_shui_overlay": {
                      "prompt": f"Traditional Chinese feng shui symbols, bagua octagon, five elements, directional compass pointing {direction}, golden lines, mystical energy patterns, transparent overlay",
                      "style": "traditional Chinese art, golden accents, spiritual",
                      "aspect_ratio": "9:16", 
                      "usage": "overlay_graphics"
                  },
                  
                  "score_visualization": {
                      "prompt": f"Feng shui score meter showing {score} points, circular progress bar, Chinese traditional design, gold and red colors, elegant numbers, professional dashboard",
                      "style": "modern UI design, Chinese aesthetics",
                      "aspect_ratio": "1:1",
                      "usage": "score_display"
                  },
                  
                  "direction_compass": {
                      "prompt": f"Ancient Chinese feng shui compass (Luopan), bronze and gold, pointing {direction} direction, mystical symbols, traditional craftsmanship, detailed engravings",
                      "style": "traditional Chinese artifacts, detailed, mystical",
                      "aspect_ratio": "1:1",
                      "usage": "direction_indicator"
                  },
                  
                  "improvement_elements": {
                      "prompt": "Feng shui improvement items, green plants, crystals, mirrors, water features, traditional Chinese decorations, modern minimalist style, clean background",
                      "style": "product photography, clean, modern",
                      "aspect_ratio": "16:9",
                      "usage": "suggestion_items"
                  },
                  
                  "before_after": {
                      "prompt": f"Split screen comparison, {room_type} before and after feng shui improvement, dramatic lighting difference, {mood} on improved side, professional interior design",
                      "style": "architectural visualization, dramatic lighting",
                      "aspect_ratio": "16:9",
                      "usage": "comparison_visual"
                  }
              }
              
              # æ·»åŠ é£æ ¼æŒ‡å¯¼
              style_guide = {
                  "color_palette": {
                      "primary": "#DAA520",  # é‡‘è‰²
                      "secondary": "#8B4513",  # æ£•è‰²
                      "accent": "#CD853F",   # ç§˜é²è‰²
                      "background": "#2F4F4F"  # æš—é’è‰²
                  },
                  "visual_principles": [
                      "Use golden ratio proportions",
                      "Incorporate traditional Chinese elements",
                      "Maintain professional, trustworthy appearance",
                      "Balance modern and traditional aesthetics",
                      "Ensure mobile-friendly composition (9:16)"
                  ],
                  "avoid": [
                      "Overly bright or flashy colors",
                      "Western religious symbols", 
                      "Cluttered compositions",
                      "Inappropriate cultural elements"
                  ]
              }
              
              return {
                  "image_prompts": prompts,
                  "style_guide": style_guide,
                  "generation_settings": {
                      "quality": "high",
                      "style": "photorealistic",
                      "lighting": "professional",
                      "composition": "rule_of_thirds"
                  }
              }
          
          # æ‰§è¡Œå‡½æ•°
          result = generate_image_prompts(
              visual_designer.output,
              feng_shui_analysis, 
              script_writer.output
          )
          
          output = json.dumps(result, ensure_ascii=False, indent=2)

    # 6. è§†é¢‘ç»“æ„ç»„è£…å™¨
    video_composer:
      type: "code"
      id: "video_structure"
      depends_on: ["script_writer", "image_prompts"]
      config:
        language: "python"
        code: |
          import json
          from datetime import datetime
          
          def create_video_composition(script, image_prompts, feng_shui_data):
              """åˆ›å»ºå®Œæ•´çš„è§†é¢‘æ„æˆç»“æ„"""
              
              # è§£æè„šæœ¬å†…å®¹ï¼ˆç®€åŒ–ç‰ˆè§£æï¼‰
              script_content = script
              
              # åŸºç¡€è§†é¢‘é…ç½®
              video_config = {
                  "format": "mp4",
                  "resolution": "1080x1920",  # ç«–å±
                  "fps": 30,
                  "duration": 60,
                  "quality": "high"
              }
              
              # åœºæ™¯æ„æˆ
              scenes = [
                  {
                      "id": "opening",
                      "start_time": 0,
                      "duration": 5,
                      "elements": [
                          {
                              "type": "background_video",
                              "source": "generated_image",
                              "prompt": image_prompts["image_prompts"]["background_main"]["prompt"],
                              "animation": "slow_zoom_in",
                              "duration": 5
                          },
                          {
                              "type": "text_overlay",
                              "content": f"é£æ°´è¯„åˆ†ï¼š{feng_shui_data.get('score', 0)}åˆ†",
                              "style": {
                                  "font": "PingFang SC Bold",
                                  "size": 48,
                                  "color": "#DAA520",
                                  "position": "center_top",
                                  "background": "rgba(0,0,0,0.6)",
                                  "padding": 20
                              },
                              "animation": "fade_in_from_top",
                              "start_time": 0.5,
                              "duration": 4
                          },
                          {
                              "type": "text_overlay", 
                              "content": "ä¸“ä¸šAIé£æ°´åˆ†æ",
                              "style": {
                                  "font": "PingFang SC",
                                  "size": 32,
                                  "color": "#FFFFFF",
                                  "position": "center",
                                  "animation": "typewriter"
                              },
                              "start_time": 1.5,
                              "duration": 3
                          }
                      ],
                      "audio": {
                          "voiceover": "å¼€åœºæ—ç™½å†…å®¹",
                          "background_music": "traditional_chinese_peaceful",
                          "volume": 0.3
                      }
                  },
                  
                  {
                      "id": "main_content",
                      "start_time": 5,
                      "duration": 45,
                      "elements": [
                          {
                              "type": "background_video",
                              "source": "generated_image",
                              "prompt": image_prompts["image_prompts"]["background_main"]["prompt"],
                              "animation": "parallax_scroll",
                              "duration": 45
                          },
                          {
                              "type": "overlay_graphics",
                              "source": "generated_image", 
                              "prompt": image_prompts["image_prompts"]["feng_shui_overlay"]["prompt"],
                              "opacity": 0.4,
                              "animation": "gentle_float",
                              "duration": 45
                          },
                          {
                              "type": "score_meter",
                              "source": "generated_image",
                              "prompt": image_prompts["image_prompts"]["score_visualization"]["prompt"],
                              "position": "top_right",
                              "animation": "count_up_to_score",
                              "start_time": 2,
                              "duration": 8
                          },
                          {
                              "type": "direction_compass",
                              "source": "generated_image",
                              "prompt": image_prompts["image_prompts"]["direction_compass"]["prompt"], 
                              "position": "bottom_left",
                              "animation": "rotate_to_direction",
                              "start_time": 5,
                              "duration": 10
                          },
                          {
                              "type": "improvement_showcase",
                              "source": "generated_image",
                              "prompt": image_prompts["image_prompts"]["improvement_elements"]["prompt"],
                              "position": "center_bottom",
                              "animation": "slide_in_sequence",
                              "start_time": 15,
                              "duration": 20
                          },
                          {
                              "type": "scrolling_text",
                              "content": feng_shui_data.get('suggestions', []),
                              "style": {
                                  "font": "PingFang SC",
                                  "size": 28,
                                  "color": "#FFFFFF",
                                  "background": "rgba(0,0,0,0.8)",
                                  "padding": 15,
                                  "line_height": 1.4
                              },
                              "position": "bottom_center", 
                              "animation": "scroll_up",
                              "start_time": 10,
                              "duration": 30
                          }
                      ],
                      "audio": {
                          "voiceover": "ä¸»è¦å†…å®¹æ—ç™½",
                          "background_music": "continue",
                          "sound_effects": ["page_turn", "gentle_chime"]
                      }
                  },
                  
                  {
                      "id": "call_to_action",
                      "start_time": 50,
                      "duration": 10,
                      "elements": [
                          {
                              "type": "gradient_background",
                              "colors": ["#DAA520", "#B8860B", "#2F4F4F"],
                              "animation": "gentle_pulse",
                              "duration": 10
                          },
                          {
                              "type": "main_cta_text",
                              "content": "ç«‹å³è·å–ä¸“ä¸šé£æ°´åˆ†æ",
                              "style": {
                                  "font": "PingFang SC Bold",
                                  "size": 40,
                                  "color": "#FFFFFF",
                                  "position": "center",
                                  "shadow": "0 4px 8px rgba(0,0,0,0.5)"
                              },
                              "animation": "bounce_in",
                              "start_time": 1,
                              "duration": 8
                          },
                          {
                              "type": "qr_code",
                              "content": "https://your-website.com",
                              "position": "bottom_center",
                              "size": 120,
                              "animation": "fade_in_scale",
                              "start_time": 2,
                              "duration": 7
                          },
                          {
                              "type": "website_url", 
                              "content": "AIé£æ°´å¤§å¸ˆå®˜ç½‘",
                              "style": {
                                  "font": "PingFang SC",
                                  "size": 24,
                                  "color": "#F0F0F0",
                                  "position": "below_qr"
                              },
                              "start_time": 3,
                              "duration": 6
                          }
                      ],
                      "audio": {
                          "voiceover": "è¡ŒåŠ¨å·å¬æ—ç™½",
                          "background_music": "crescendo_finish",
                          "sound_effects": ["success_chime"]
                      }
                  }
              ]
              
              # å¯¼å‡ºé…ç½®
              export_settings = {
                  "watermark": {
                      "text": "AIé£æ°´å¤§å¸ˆ",
                      "position": "bottom_right",
                      "opacity": 0.7,
                      "font": "PingFang SC",
                      "size": 16,
                      "color": "#DAA520"
                  },
                  "captions": {
                      "enable": True,
                      "font": "PingFang SC",
                      "size": 32,
                      "color": "#FFFFFF",
                      "background": "rgba(0,0,0,0.7)",
                      "position": "bottom_center"
                  },
                  "metadata": {
                      "title": f"é£æ°´è¯„åˆ†{feng_shui_data.get('score', 0)}åˆ†çš„{feng_shui_data.get('room_type', 'ä½å®…')}åˆ†æ",
                      "description": f"ä¸“ä¸šAIé£æ°´åˆ†æï¼š{feng_shui_data.get('summary', 'è¯¦ç»†åˆ†ææŠ¥å‘Š')}",
                      "tags": ["é£æ°´", "AIåˆ†æ", "å±…å®¶å¸ƒå±€", "è¿åŠ¿", feng_shui_data.get('room_type', 'ä½å®…')],
                      "category": "education_lifestyle"
                  }
              }
              
              return {
                  "video_config": video_config,
                  "scenes": scenes,
                  "export_settings": export_settings,
                  "total_duration": 60,
                  "created_at": datetime.now().isoformat()
              }
          
          # æ‰§è¡Œå‡½æ•°
          result = create_video_composition(
              script_writer.output,
              image_prompts.output,
              feng_shui_analysis
          )
          
          output = json.dumps(result, ensure_ascii=False, indent=2)

    # 7. å¹³å°é€‚é…ä¼˜åŒ–å™¨
    platform_optimizer:
      type: "code"
      id: "platform_versions"
      depends_on: ["video_structure"]
      config:
        language: "python"
        code: |
          import json
          import copy
          
          def optimize_for_platforms(base_video, target_platforms, feng_shui_data):
              """ä¸ºä¸åŒå¹³å°ä¼˜åŒ–è§†é¢‘å†…å®¹"""
              
              platform_configs = {
                  "douyin": {
                      "name": "æŠ–éŸ³",
                      "optimization": {
                          "hook_duration": 3,  # å‰3ç§’æå…¶é‡è¦
                          "text_style": "bold_impact",
                          "color_scheme": "high_contrast",
                          "trending_elements": True,
                          "music_sync": True
                      },
                      "content_focus": "entertainment_viral",
                      "audience": "18-35å²éƒ½å¸‚å¹´è½»äºº",
                      "posting_tips": [
                          "ä½¿ç”¨çƒ­é—¨éŸ³ä¹BGM",
                          "æ ‡é¢˜è¦æœ‰æ‚¬å¿µå’Œå†²çª",
                          "å‰3ç§’å¿…é¡»æœ‰è§†è§‰å†²å‡»",
                          "é€‚å½“æ·»åŠ ç½‘çº¢å…ƒç´ "
                      ]
                  },
                  
                  "xiaohongshu": {
                      "name": "å°çº¢ä¹¦",
                      "optimization": {
                          "aesthetic_priority": True,
                          "detailed_info": True,
                          "lifestyle_focus": True,
                          "clean_design": True
                      },
                      "content_focus": "practical_aesthetic",
                      "audience": "25-40å²ç²¾è‡´å¥³æ€§",
                      "posting_tips": [
                          "å°é¢å›¾è¦ç²¾ç¾æœ‰å¸å¼•åŠ›",
                          "å†…å®¹è¦å®ç”¨ä¸”ç¾è§‚",
                          "å¤šç”¨emojiå’Œæ ‡ç­¾",
                          "å¼ºè°ƒç”Ÿæ´»å“è´¨æå‡"
                      ]
                  },
                  
                  "kuaishou": {
                      "name": "å¿«æ‰‹",
                      "optimization": {
                          "authentic_feel": True,
                          "practical_value": True,
                          "down_to_earth": True,
                          "family_friendly": True
                      },
                      "content_focus": "practical_authentic",
                      "audience": "25-50å²ä¸‰å››çº¿åŸå¸‚",
                      "posting_tips": [
                          "è¯­è¨€è¦æ¥åœ°æ°”",
                          "å¼ºè°ƒå®ç”¨ä»·å€¼",
                          "æ¡ˆä¾‹è¦è´´è¿‘ç”Ÿæ´»",
                          "ä»·æ ¼è¦å®æƒ äº²æ°‘"
                      ]
                  }
              }
              
              optimized_versions = {}
              
              for platform in target_platforms:
                  if platform not in platform_configs:
                      continue
                      
                  config = platform_configs[platform]
                  platform_video = copy.deepcopy(base_video)
                  
                  # å¹³å°ç‰¹å®šä¼˜åŒ–
                  if platform == "douyin":
                      # æŠ–éŸ³ï¼šå¼ºåŒ–å¼€åœºæ•ˆæœ
                      opening_scene = platform_video["scenes"][0]
                      
                      # æ·»åŠ å¼ºå†²å‡»å¼€åœº
                      opening_scene["elements"].insert(0, {
                          "type": "shock_text",
                          "content": f"éœ‡æƒŠï¼è¿™å¥—æˆ¿å­é£æ°´è¯„åˆ†ç«Ÿç„¶{feng_shui_data.get('score', 0)}åˆ†ï¼",
                          "style": {
                              "font": "PingFang SC Black",
                              "size": 52,
                              "color": "#FF6B35",
                              "stroke": "#FFFFFF",
                              "position": "center",
                              "animation": "flash_attention"
                          },
                          "start_time": 0,
                          "duration": 2.5
                      })
                      
                      # æ·»åŠ çƒ­é—¨æ ‡ç­¾
                      platform_video["export_settings"]["metadata"]["tags"].extend([
                          "éœ‡æƒŠ", "å¿…çœ‹", "æ¶¨çŸ¥è¯†", "ç¥ç§˜"
                      ])
                  
                  elif platform == "xiaohongshu":
                      # å°çº¢ä¹¦ï¼šä¼˜åŒ–ç¾å­¦å’Œå®ç”¨æ€§
                      for scene in platform_video["scenes"]:
                          for element in scene["elements"]:
                              if element.get("type") == "text_overlay":
                                  # å°çº¢ä¹¦æ–‡å­—æ›´ç²¾ç¾
                                  element["style"]["background"] = "rgba(255,255,255,0.9)"
                                  element["style"]["color"] = "#333333"
                                  element["style"]["border_radius"] = 12
                                  element["style"]["shadow"] = "0 4px 12px rgba(0,0,0,0.1)"
                      
                      # æ·»åŠ ç”Ÿæ´»åŒ–æ ‡ç­¾
                      platform_video["export_settings"]["metadata"]["tags"].extend([
                          "å±…å®¶å¥½ç‰©", "ç”Ÿæ´»tips", "å®¶å±…è®¾è®¡", "å“è´¨ç”Ÿæ´»"
                      ])
                  
                  elif platform == "kuaishou":
                      # å¿«æ‰‹ï¼šå¼ºè°ƒå®ç”¨å’Œäº²æ°‘
                      for scene in platform_video["scenes"]:
                          for element in scene["elements"]:
                              if element.get("type") == "text_overlay":
                                  # å¿«æ‰‹æ–‡å­—æ›´æœ´å®
                                  if "ä¸“ä¸šAI" in element.get("content", ""):
                                      element["content"] = element["content"].replace("ä¸“ä¸šAI", "æ™ºèƒ½")
                      
                      # æ·»åŠ å®ç”¨æ ‡ç­¾
                      platform_video["export_settings"]["metadata"]["tags"].extend([
                          "å®ç”¨", "çœé’±", "å±…å®¶å¦™æ‹›", "è€ç™¾å§“"
                      ])
                  
                  # è®¾ç½®å¹³å°ç‰¹å®šä¿¡æ¯
                  platform_video["platform_info"] = {
                      "platform": platform,
                      "platform_name": config["name"],
                      "optimization_applied": config["optimization"],
                      "target_audience": config["audience"],
                      "content_focus": config["content_focus"],
                      "posting_tips": config["posting_tips"]
                  }
                  
                  optimized_versions[platform] = platform_video
              
              return optimized_versions
          
          # æ‰§è¡Œä¼˜åŒ–
          result = optimize_for_platforms(
              video_structure.output,
              target_platforms,
              feng_shui_analysis
          )
          
          output = json.dumps(result, ensure_ascii=False, indent=2)

    # 8. å†…å®¹å‘å¸ƒè®¡åˆ’å™¨
    content_scheduler:
      type: "code"
      id: "publishing_calendar"
      depends_on: ["platform_versions"]
      config:
        language: "python"
        code: |
          import json
          from datetime import datetime, timedelta
          import random
          
          def generate_publishing_calendar(platform_versions, feng_shui_data):
              """ç”Ÿæˆ7å¤©å†…å®¹å‘å¸ƒè®¡åˆ’"""
              
              today = datetime.now()
              calendar = []
              
              # å¹³å°å‘å¸ƒæ—¶é—´é…ç½®
              platform_schedules = {
                  "douyin": {
                      "frequency": 3,  # æ¯å‘¨3æ¬¡
                      "best_times": ["08:30", "12:30", "19:00", "21:30"],
                      "peak_days": [1, 3, 5, 6]  # å‘¨äºŒã€å››ã€å…­ã€æ—¥
                  },
                  "xiaohongshu": {
                      "frequency": 2,  # æ¯å‘¨2æ¬¡  
                      "best_times": ["10:00", "14:00", "19:30", "21:00"],
                      "peak_days": [0, 2, 4, 6]  # å‘¨ä¸€ã€ä¸‰ã€äº”ã€æ—¥
                  },
                  "kuaishou": {
                      "frequency": 2,  # æ¯å‘¨2æ¬¡
                      "best_times": ["12:00", "18:30", "20:00", "22:00"], 
                      "peak_days": [2, 4, 5, 6]  # å‘¨ä¸‰ã€äº”ã€å…­ã€æ—¥
                  }
              }
              
              schedule_id = 1
              
              for platform, video_data in platform_versions.items():
                  if platform not in platform_schedules:
                      continue
                      
                  schedule = platform_schedules[platform]
                  platform_info = video_data.get("platform_info", {})
                  
                  # ä¸ºè¯¥å¹³å°å®‰æ’å‘å¸ƒæ—¶é—´
                  posts_scheduled = 0
                  day_offset = 0
                  
                  while posts_scheduled < schedule["frequency"] and day_offset < 7:
                      post_date = today + timedelta(days=day_offset)
                      weekday = post_date.weekday()
                      
                      # æ£€æŸ¥æ˜¯å¦æ˜¯è¯¥å¹³å°çš„æ¨èå‘å¸ƒæ—¥
                      if weekday in schedule["peak_days"]:
                          # é€‰æ‹©æœ€ä½³å‘å¸ƒæ—¶é—´
                          time_slot = random.choice(schedule["best_times"])
                          
                          # ç”Ÿæˆå†…å®¹å˜ä½“
                          content_variant = generate_content_variant(
                              feng_shui_data, 
                              platform, 
                              posts_scheduled + 1
                          )
                          
                          calendar_item = {
                              "id": schedule_id,
                              "date": post_date.strftime("%Y-%m-%d"),
                              "time": time_slot,
                              "platform": platform,
                              "platform_name": platform_info.get("platform_name", platform),
                              "content": {
                                  "title": content_variant["title"],
                                  "description": content_variant["description"],
                                  "hashtags": content_variant["hashtags"],
                                  "video_config": video_data.get("video_config"),
                                  "special_notes": content_variant["notes"]
                              },
                              "targeting": {
                                  "audience": platform_info.get("target_audience", ""),
                                  "content_focus": platform_info.get("content_focus", ""),
                                  "optimization_tips": platform_info.get("posting_tips", [])
                              },
                              "status": "scheduled",
                              "priority": get_priority(platform, weekday, time_slot)
                          }
                          
                          calendar.append(calendar_item)
                          posts_scheduled += 1
                          schedule_id += 1
                      
                      day_offset += 1
              
              # æŒ‰æ—¥æœŸå’Œæ—¶é—´æ’åº
              calendar.sort(key=lambda x: f"{x['date']} {x['time']}")
              
              # ç”Ÿæˆæ€»ç»“æŠ¥å‘Š
              summary = {
                  "total_posts": len(calendar),
                  "platforms_count": len(platform_versions),
                  "date_range": {
                      "start": calendar[0]["date"] if calendar else "",
                      "end": calendar[-1]["date"] if calendar else ""
                  },
                  "platform_distribution": {
                      platform: len([item for item in calendar if item["platform"] == platform])
                      for platform in platform_versions.keys()
                  },
                  "weekly_frequency": {
                      "douyin": platform_schedules.get("douyin", {}).get("frequency", 0),
                      "xiaohongshu": platform_schedules.get("xiaohongshu", {}).get("frequency", 0), 
                      "kuaishou": platform_schedules.get("kuaishou", {}).get("frequency", 0)
                  }
              }
              
              return {
                  "publishing_calendar": calendar,
                  "summary": summary,
                  "automation_suggestions": [
                      "ä½¿ç”¨ç¤¾äº¤åª’ä½“ç®¡ç†å·¥å…·å®šæ—¶å‘å¸ƒ",
                      "å‡†å¤‡ä¸€å‘¨çš„è§†è§‰ç´ æ",
                      "ç›‘æ§å‘å¸ƒåçš„æ•°æ®è¡¨ç°",
                      "æ ¹æ®æ•°æ®åé¦ˆè°ƒæ•´å‘å¸ƒç­–ç•¥",
                      "å»ºç«‹ç”¨æˆ·äº’åŠ¨å›å¤æ¨¡æ¿"
                  ],
                  "success_metrics": {
                      "engagement_rate": "ç›®æ ‡ >5%",
                      "completion_rate": "ç›®æ ‡ >70%",
                      "website_clicks": "ç›®æ ‡æ¯å‘¨ >100æ¬¡",
                      "new_followers": "ç›®æ ‡æ¯å‘¨ >500äºº"
                  }
              }
          
          def generate_content_variant(feng_shui_data, platform, variant_num):
              """ä¸ºåŒä¸€å†…å®¹ç”Ÿæˆä¸åŒçš„å‘å¸ƒå˜ä½“"""
              
              score = feng_shui_data.get("score", 70)
              room_type = feng_shui_data.get("room_type", "ä½å®…")
              level = feng_shui_data.get("level", "ä¸­ç­‰")
              
              variants = {
                  "douyin": [
                      {
                          "title": f"éœ‡æƒŠï¼{room_type}é£æ°´è¯„åˆ†{score}åˆ†æ„å‘³ç€ä»€ä¹ˆï¼Ÿ",
                          "description": f"ä¸“ä¸šAIåˆ†ææ­ç§˜ï¼š{level}æ ¼å±€çš„{room_type}å¦‚ä½•å½±å“è¿åŠ¿",
                          "hashtags": ["#é£æ°´ç§˜å¯†", "#è¿åŠ¿åˆ†æ", "#éœ‡æƒŠ", "#å¿…çœ‹"],
                          "notes": "ä½¿ç”¨çƒ­é—¨BGMï¼Œå‰3ç§’è¦æœ‰å¼ºå†²å‡»"
                      },
                      {
                          "title": f"ä¸çœ‹åæ‚”ï¼{room_type}çš„é£æ°´ç¦å¿Œå¤§æ­ç§˜",
                          "description": f"AIå¤§å¸ˆå‘Šè¯‰ä½ ï¼šä¸ºä»€ä¹ˆè¿™ä¸ª{room_type}åªæœ‰{score}åˆ†",
                          "hashtags": ["#é£æ°´ç¦å¿Œ", "#å®¶å±…å¸ƒå±€", "#æ¶¨çŸ¥è¯†", "#å®ç”¨"],
                          "notes": "é‡ç‚¹çªå‡ºç¦å¿Œå’Œè§£å†³æ–¹æ¡ˆ"
                      },
                      {
                          "title": f"3åˆ†é’Ÿæ•™ä½ çœ‹{room_type}é£æ°´ï¼å‡†åˆ°ç¦»è°±",
                          "description": f"ä»{score}åˆ†çœ‹å‡ºçš„é—®é¢˜ï¼Œä½ å®¶ä¹Ÿå¯èƒ½æœ‰ï¼",
                          "hashtags": ["#é£æ°´æ•™å­¦", "#å±…å®¶æŠ€å·§", "#å‡†åˆ°ç¦»è°±", "#å­¦ä¼šäº†"],
                          "notes": "æ•™å­¦å‘å†…å®¹ï¼Œäº’åŠ¨æ€§å¼º"
                      }
                  ],
                  
                  "xiaohongshu": [
                      {
                          "title": f"ğŸ  {room_type}é£æ°´åˆ†æï½œ{score}åˆ†çš„çœŸç›¸",
                          "description": f"âœ¨ ä¸“ä¸šAIæ·±åº¦è§£æ {level}é£æ°´æ ¼å±€\nğŸ” è¯¦ç»†æ”¹å–„å»ºè®®åˆ†äº«\nğŸ’« è®©å®¶æ›´æœ‰çµæ°”çš„ç§˜å¯†",
                          "hashtags": ["#é£æ°´åˆ†æ", "#å®¶å±…è®¾è®¡", "#å±…å®¶å¥½ç‰©", "#ç”Ÿæ´»ç¾å­¦"],
                          "notes": "æ³¨é‡ç¾è§‚å’Œå®ç”¨æ€§ï¼Œå¤šç”¨emoji"
                      },
                      {
                          "title": f"ğŸ’¡ {room_type}å¸ƒå±€ä¼˜åŒ–æŒ‡å—ï½œå®æµ‹æœ‰æ•ˆ",
                          "description": f"ğŸ¯ AIåˆ†æè¯„åˆ†{score}åˆ†\nğŸ“‹ ä¸“ä¸šæ”¹å–„æ–¹æ¡ˆåˆ†äº«\nğŸŒŸ è®©è¿åŠ¿UP UPçš„å°æŠ€å·§",
                          "hashtags": ["#å®¶å±…å¸ƒå±€", "#è£…ä¿®çµæ„Ÿ", "#å±…å®¶æŠ€å·§", "#å“è´¨ç”Ÿæ´»"],
                          "notes": "å¼ºè°ƒå®ç”¨ä»·å€¼å’Œç¾å­¦æ•ˆæœ"
                      }
                  ],
                  
                  "kuaishou": [
                      {
                          "title": f"è€å¸ˆå‚…æ•™ä½ çœ‹{room_type}é£æ°´ï¼Œ{score}åˆ†ä¸ç®—é«˜ï¼",
                          "description": f"ä¼ ç»Ÿé£æ°´æ™ºæ…§+AIåˆ†æï¼Œæ•™ä½ ç®€å•å®ç”¨çš„æ”¹å–„æ–¹æ³•",
                          "hashtags": ["#é£æ°´çŸ¥è¯†", "#å®ç”¨æŠ€å·§", "#è€å¸ˆå‚…", "#å±…å®¶å¦™æ‹›"],
                          "notes": "ç”¨æ¥åœ°æ°”çš„è¯­è¨€ï¼Œå¼ºè°ƒä¼ ç»Ÿæ™ºæ…§"
                      },
                      {
                          "title": f"èŠ±å°é’±æ”¹{room_type}é£æ°´ï¼Œæ•ˆæœç«‹ç«¿è§å½±ï¼",
                          "description": f"ä¸èŠ±å¤§é’±ä¹Ÿèƒ½æ”¹å–„é£æ°´ï¼Œ{score}åˆ†æå‡åˆ°90åˆ†çš„ç§˜å¯†",
                          "hashtags": ["#çœé’±å¦™æ‹›", "#å±…å®¶æ”¹é€ ", "#å®ç”¨", "#æ•ˆæœå¥½"],
                          "notes": "å¼ºè°ƒæ€§ä»·æ¯”å’Œå®é™…æ•ˆæœ"
                      }
                  ]
              }
              
              platform_variants = variants.get(platform, variants["douyin"])
              variant_index = (variant_num - 1) % len(platform_variants)
              return platform_variants[variant_index]
          
          def get_priority(platform, weekday, time):
              """è®¡ç®—å‘å¸ƒä¼˜å…ˆçº§"""
              priority_score = 0
              
              # å¹³å°æƒé‡
              if platform == "douyin":
                  priority_score += 3
              elif platform == "xiaohongshu":
                  priority_score += 2
              else:
                  priority_score += 1
              
              # æ—¶é—´æƒé‡
              if time in ["19:00", "20:00", "21:00"]:
                  priority_score += 2
              elif time in ["12:00", "12:30"]:
                  priority_score += 1
              
              # å‘¨å‡ æƒé‡
              if weekday in [4, 5, 6]:  # å‘¨äº”ã€å…­ã€æ—¥
                  priority_score += 1
              
              if priority_score >= 5:
                  return "high"
              elif priority_score >= 3:
                  return "medium"
              else:
                  return "low"
          
          # æ‰§è¡Œå‡½æ•°
          result = generate_publishing_calendar(
              platform_versions.output,
              feng_shui_analysis
          )
          
          output = json.dumps(result, ensure_ascii=False, indent=2)

    # 9. è¾“å‡ºèŠ‚ç‚¹
    output:
      type: "output"
      id: "final_output"
      depends_on: ["publishing_calendar"]
      outputs:
        video_script: "{{script_writer.output}}"
        visual_design: "{{visual_designer.output}}"
        image_prompts: "{{image_prompts.output}}"
        video_composition: "{{video_structure.output}}"
        platform_versions: "{{platform_versions.output}}"
        publishing_schedule: "{{publishing_calendar.output}}"

  # è§¦å‘å™¨é…ç½®
  triggers:
    webhook:
      enabled: true
      url_path: "/webhook/video-generation"
      method: "POST"
      description: "é£æ°´åˆ†æå®Œæˆåè‡ªåŠ¨è§¦å‘è§†é¢‘ç”Ÿæˆ"
    
    scheduled:
      enabled: false
      cron: "0 10 * * *"
      description: "æ¯æ—¥ä¸Šåˆ10ç‚¹è‡ªåŠ¨ç”Ÿæˆå†…å®¹"

  # å…¨å±€è®¾ç½®
  settings:
    timeout: 300
    retry_attempts: 3
    parallel_execution: false
    error_handling: "continue_on_error"
    logging_level: "info"

# ä½¿ç”¨è¯´æ˜
usage:
  description: "å°†æ­¤YAMLæ–‡ä»¶å¯¼å…¥Difyå¹³å°ï¼Œé…ç½®APIå¯†é’¥åå³å¯ä½¿ç”¨"
  
  setup_steps:
    - "åœ¨Difyå¹³å°åˆ›å»ºæ–°çš„å·¥ä½œæµ"
    - "å¯¼å…¥æ­¤YAMLé…ç½®æ–‡ä»¶"
    - "é…ç½®OpenAI APIå¯†é’¥"
    - "é…ç½®å›¾åƒç”ŸæˆæœåŠ¡API"
    - "æµ‹è¯•å·¥ä½œæµæ‰§è¡Œ"
    - "è¿æ¥ç½‘ç«™Webhookè§¦å‘"
  
  input_example:
    feng_shui_analysis:
      score: 78
      level: "ä¸­å‰æ ¼å±€"
      summary: "æ•´ä½“é£æ°´æ ¼å±€è‰¯å¥½ï¼Œè´¢ä½æ˜ç¡®ï¼Œéœ€è¦æ³¨æ„å§å®¤é—¨å¯¹å•æ‰€é—¨çš„é—®é¢˜"
      suggestions: ["åœ¨å§å®¤é—¨æŒ‚é—¨å¸˜é®æŒ¡", "åœ¨è´¢ä½æ‘†æ”¾ç»¿è‰²æ¤ç‰©", "è°ƒæ•´åºŠå¤´æœå‘"]
      room_type: "ä¸‰å®¤ä¸€å…"
      direction: "ååŒ—æœå—"
      areas:
        score_area: {"score": 8, "description": "è¯„åˆ†è‰¯å¥½"}
        direction_area: {"score": 9, "description": "æœå‘æä½³"}
        layout_area: {"score": 7, "description": "å¸ƒå±€åˆç†"}
    
    video_style: "professional"
    target_platforms: ["douyin", "xiaohongshu", "kuaishou"]
  
  expected_output:
    - "3ä¸ªå¹³å°ä¼˜åŒ–çš„è§†é¢‘è„šæœ¬"
    - "è¯¦ç»†çš„è§†è§‰è®¾è®¡æ–¹æ¡ˆ"
    - "AIå›¾åƒç”Ÿæˆæç¤ºè¯é›†åˆ"
    - "å®Œæ•´çš„60ç§’è§†é¢‘æ„æˆ"
    - "7å¤©å†…å®¹å‘å¸ƒæ—¥å†"
    - "å¹³å°ç‰¹å®šä¼˜åŒ–å»ºè®®"

# æˆæœ¬ä¼°ç®—
cost_estimation:
  monthly_usage: "å‡è®¾æ¯æ—¥ç”Ÿæˆ3æ¡è§†é¢‘å†…å®¹"
  api_calls:
    openai_gpt4: "çº¦900æ¬¡è°ƒç”¨/æœˆï¼Œé¢„è®¡$45-90"
    image_generation: "çº¦540å¼ å›¾ç‰‡/æœˆï¼Œé¢„è®¡$27-54"
  total_estimated_cost: "$72-144/æœˆ"
  
  compared_to_coze: "æ¯”CozeèŠ‚çœçº¦Â¥200/æœˆï¼Œæˆæœ¬ä¼˜åŠ¿æ˜æ˜¾"
