# AIé£æ°´åˆ†æç½‘ç«™ - æŠ€æœ¯å®ç°æ–¹æ¡ˆ

## 1. 3æ¡£äº§å“æŠ€æœ¯æ¶æ„

### 1.1 äº§å“åˆ†çº§é€»è¾‘è®¾è®¡

**æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼š**
- æ‰€æœ‰ç”¨æˆ·ä½¿ç”¨åŒä¸€å¥—AIåˆ†æå¼•æ“
- é€šè¿‡è¾“å‡ºæ§åˆ¶å®ç°ä¸åŒæ¡£æ¬¡çš„å·®å¼‚
- ä¿æŒä»£ç ç®€æ´ï¼Œé¿å…é‡å¤å¼€å‘

**åˆ†çº§æ§åˆ¶ç­–ç•¥ï¼š**

```javascript
// äº§å“åˆ†çº§æšä¸¾
const PRODUCT_TIERS = {
    FREE: 'free',
    STANDARD: 'standard', 
    PREMIUM: 'premium'
};

// åˆ†çº§é…ç½®
const TIER_CONFIG = {
    free: {
        maxProblems: 3,           // æœ€å¤šæ˜¾ç¤º3ä¸ªé—®é¢˜
        showScores: false,        // ä¸æ˜¾ç¤ºè¯„åˆ†
        solutionsPerProblem: 1,   // æ¯ä¸ªé—®é¢˜1ä¸ªè§£å†³æ–¹æ¡ˆ
        showUpgrade: true,        // æ˜¾ç¤ºå‡çº§æç¤º
        reportFormat: 'simple'    // ç®€å•æŠ¥å‘Šæ ¼å¼
    },
    standard: {
        maxProblems: 999,         // æ˜¾ç¤ºæ‰€æœ‰é—®é¢˜
        showScores: true,         // æ˜¾ç¤ºåˆ†åŒºè¯„åˆ†
        solutionsPerProblem: 3,   // æ¯ä¸ªé—®é¢˜3ä¸ªè§£å†³æ–¹æ¡ˆ
        showUpgrade: true,        // æ˜¾ç¤ºå‡çº§åˆ°Premium
        reportFormat: 'detailed', // è¯¦ç»†æŠ¥å‘Šæ ¼å¼
        pdfDownload: true         // æ”¯æŒPDFä¸‹è½½
    },
    premium: {
        maxProblems: 999,         // æ˜¾ç¤ºæ‰€æœ‰é—®é¢˜
        showScores: true,         // æ˜¾ç¤ºåˆ†åŒºè¯„åˆ†
        solutionsPerProblem: 5,   // æ¯ä¸ªé—®é¢˜5ä¸ªè§£å†³æ–¹æ¡ˆ
        showUpgrade: false,       // ä¸æ˜¾ç¤ºå‡çº§
        reportFormat: 'premium',  // é«˜çº§æŠ¥å‘Šæ ¼å¼
        pdfDownload: true,        // æ”¯æŒPDFä¸‹è½½
        personalizedAnalysis: true, // ç”Ÿè¾°å…«å­—åˆ†æ
        actionPlan: true,         // é˜¶æ®µæ€§è¡ŒåŠ¨è®¡åˆ’
        consultationAccess: true  // å’¨è¯¢æœåŠ¡
    }
};
```

### 1.2 æƒé™æ§åˆ¶ç³»ç»Ÿ

**ç”¨æˆ·è¯†åˆ«æœºåˆ¶ï¼š**
- éªŒè¯æœŸï¼šåŸºäºæŒ‡çº¹è¯†åˆ«ï¼Œæ‰€æœ‰ç”¨æˆ·é»˜è®¤FREEçº§åˆ«
- å•†ä¸šåŒ–åï¼šåŸºäºç”¨æˆ·è´¦æˆ·å’Œè®¢å•è®°å½•

**æƒé™æ£€æŸ¥æµç¨‹ï¼š**

```javascript
// æƒé™ç®¡ç†å™¨
class TierManager {
    constructor() {
        this.validationMode = process.env.VALIDATION_MODE === 'true';
    }
    
    // è·å–ç”¨æˆ·ç­‰çº§
    getUserTier(fingerprint, orderId = null) {
        if (this.validationMode) {
            // éªŒè¯æœŸæ¨¡å¼ï¼šæ‰€æœ‰ç”¨æˆ·FREEï¼Œä½†å¯ä»¥æ¨¡æ‹Ÿå‡çº§
            const simulatedTier = this.getSimulatedTier(fingerprint);
            return simulatedTier || 'free';
        }
        
        // æ­£å¼å•†ä¸šåŒ–æ¨¡å¼ï¼šåŸºäºè®¢å•æŸ¥è¯¢
        return this.getTierByOrder(orderId) || 'free';
    }
    
    // éªŒè¯æœŸæ¨¡æ‹Ÿå‡çº§ï¼ˆç”¨äºæµ‹è¯•ä»˜è´¹æ„æ„¿ï¼‰
    simulateUpgrade(fingerprint, targetTier, email) {
        this.recordUpgradeIntent(fingerprint, {
            targetTier,
            email,
            timestamp: new Date(),
            simulated: true
        });
        
        // ä¸´æ—¶ç»™ç”¨æˆ·é«˜çº§æƒé™ä½“éªŒ
        this.setSimulatedTier(fingerprint, targetTier, 24 * 60 * 60 * 1000); // 24å°æ—¶
        
        return {
            success: true,
            message: `éªŒè¯æœŸå…è´¹ä½“éªŒ${targetTier}åŠŸèƒ½24å°æ—¶`,
            tier: targetTier
        };
    }
}
```

### 1.3 åˆ†ææ·±åº¦æ§åˆ¶æœºåˆ¶

**AIåˆ†ææµç¨‹æ§åˆ¶ï¼š**

```javascript
// åŸæœ‰çš„é£æ°´åˆ†æå™¨å‡çº§
class FengshuiAnalyzer {
    async analyze(formData, language, tier = 'free') {
        // 1. AIåˆ†æï¼ˆæ‰€æœ‰çº§åˆ«éƒ½è¿›è¡Œå®Œæ•´åˆ†æï¼‰
        const fullAnalysis = await this.performFullAnalysis(formData, language);
        
        // 2. æ ¹æ®çº§åˆ«è¿‡æ»¤è¾“å‡º
        const filteredResult = this.filterByTier(fullAnalysis, tier);
        
        // 3. æ·»åŠ çº§åˆ«ç‰¹å®šå†…å®¹
        const enhancedResult = await this.enhanceByTier(filteredResult, formData, tier);
        
        return enhancedResult;
    }
    
    // æ ¹æ®çº§åˆ«è¿‡æ»¤åˆ†æç»“æœ
    filterByTier(analysis, tier) {
        const config = TIER_CONFIG[tier];
        
        return {
            // åŸºç¡€ä¿¡æ¯ï¼ˆæ‰€æœ‰çº§åˆ«ï¼‰
            summary: analysis.summary,
            overallGrade: analysis.overallGrade,
            
            // é—®é¢˜åˆ—è¡¨ï¼ˆæŒ‰çº§åˆ«é™åˆ¶ï¼‰
            problems: analysis.problems.slice(0, config.maxProblems).map(problem => ({
                ...problem,
                solutions: problem.solutions.slice(0, config.solutionsPerProblem)
            })),
            
            // è¯„åˆ†ä¿¡æ¯ï¼ˆæŒ‰çº§åˆ«æ˜¾ç¤ºï¼‰
            scores: config.showScores ? analysis.scores : null,
            
            // å‡çº§æç¤º
            upgradePrompt: config.showUpgrade ? this.generateUpgradePrompt(tier) : null
        };
    }
    
    // æ ¹æ®çº§åˆ«å¢å¼ºåˆ†æç»“æœ
    async enhanceByTier(result, formData, tier) {
        const config = TIER_CONFIG[tier];
        
        if (tier === 'premium' && config.personalizedAnalysis) {
            // Premiumçº§åˆ«ï¼šæ·»åŠ ç”Ÿè¾°å…«å­—åˆ†æ
            if (formData.birthDate && formData.birthTime) {
                result.personalizedAdvice = await this.generatePersonalizedAdvice(
                    formData.birthDate, 
                    formData.birthTime, 
                    result
                );
            }
            
            // æ·»åŠ é˜¶æ®µæ€§è¡ŒåŠ¨è®¡åˆ’
            if (config.actionPlan) {
                result.actionPlan = this.generateActionPlan(result.problems);
            }
        }
        
        return result;
    }
}
```

## 2. ä»£ç å®ç°è¯¦è§£

### 2.1 é£æ°´åˆ†æå™¨åˆ†çº§æ”¹é€ 

**ç°æœ‰ä»£ç è·¯å¾„ï¼š** `src/api/fengshui-analyzer.js`

**ä¸»è¦ä¿®æ”¹ç‚¹ï¼š**

1. **åœ¨analyzeæ–¹æ³•ä¸­æ·»åŠ tierå‚æ•°ï¼š**

```javascript
// åŸæœ‰æ–¹æ³•ç­¾å
async analyze(formData, language) { ... }

// æ–°æ–¹æ³•ç­¾å  
async analyze(formData, language, tier = 'free') { ... }
```

2. **å‡çº§æç¤ºç”Ÿæˆå™¨ï¼š**

```javascript
generateUpgradePrompt(currentTier) {
    const prompts = {
        free: {
            zh: {
                title: "å‡çº§è·å¾—å®Œæ•´åˆ†æ",
                features: [
                    "è¯†åˆ«æ‰€æœ‰é£æ°´é—®é¢˜ï¼ˆå½“å‰ä»…æ˜¾ç¤ºå‰3ä¸ªï¼‰",
                    "è¯¦ç»†çš„æˆ¿é—´è¯„åˆ†ç³»ç»Ÿ", 
                    "ä¸“ä¸šçš„æ”¹å–„æ–¹æ¡ˆ",
                    "PDFæŠ¥å‘Šä¸‹è½½"
                ],
                cta: "å‡çº§åˆ°æ ‡å‡†ç‰ˆ Â¥139",
                note: "éªŒè¯æœŸé—´ç‚¹å‡»å¯å…è´¹ä½“éªŒå®Œæ•´åŠŸèƒ½"
            },
            en: {
                title: "Upgrade for Complete Analysis", 
                features: [
                    "Identify all feng shui issues (currently showing only 3)",
                    "Detailed room scoring system",
                    "Professional improvement solutions",
                    "PDF report download"
                ],
                cta: "Upgrade to Standard $19.99",
                note: "Click to experience full features for free during validation"
            }
        },
        standard: {
            zh: {
                title: "ä¸ªæ€§å®šåˆ¶ç‰ˆæ›´ç²¾å‡†",
                features: [
                    "ç”Ÿè¾°å…«å­—ä¸æˆ·å‹åŒ¹é…åˆ†æ",
                    "ä¸ªæ€§åŒ–æ‘†è®¾å»ºè®®",
                    "åˆ†é˜¶æ®µä¼˜åŒ–è®¡åˆ’",
                    "ä¸“å±å’¨è¯¢æœåŠ¡"
                ],
                cta: "å‡çº§åˆ°å®šåˆ¶ç‰ˆ Â¥349"
            },
            en: {
                title: "Premium Version More Accurate",
                features: [
                    "Birth date and layout matching analysis",
                    "Personalized placement suggestions", 
                    "Phased optimization plan",
                    "Exclusive consultation service"
                ],
                cta: "Upgrade to Premium $49.99"
            }
        }
    };
    
    return prompts[currentTier];
}
```

### 2.2 ç”¨æˆ·ç­‰çº§è¯†åˆ«å’Œç®¡ç†

**ç°æœ‰ä»£ç è·¯å¾„ï¼š** `src/utils/user-manager.js`

**æ·»åŠ ç­‰çº§ç®¡ç†åŠŸèƒ½ï¼š**

```javascript
class UserManager {
    constructor() {
        // ç°æœ‰ä»£ç ä¿æŒä¸å˜
        this.users = new Map();
        
        // æ–°å¢ï¼šç”¨æˆ·ç­‰çº§ç®¡ç†
        this.userTiers = new Map();
        this.upgradeIntents = new Map();
    }
    
    // æ–°å¢ï¼šè·å–ç”¨æˆ·ç­‰çº§
    getUserTier(fingerprint) {
        const validationMode = process.env.VALIDATION_MODE === 'true';
        
        if (validationMode) {
            // éªŒè¯æœŸï¼šæ£€æŸ¥æ˜¯å¦æœ‰æ¨¡æ‹Ÿå‡çº§
            const simulated = this.userTiers.get(fingerprint);
            if (simulated && simulated.expiry > Date.now()) {
                return simulated.tier;
            }
            return 'free';
        }
        
        // æ­£å¼æ¨¡å¼ï¼šåŸºäºè®¢å•è®°å½•ï¼ˆå¾…å®ç°ï¼‰
        return this.getTierFromDatabase(fingerprint);
    }
    
    // æ–°å¢ï¼šè®°å½•å‡çº§æ„æ„¿
    recordUpgradeIntent(fingerprint, data) {
        const intents = this.upgradeIntents.get(fingerprint) || [];
        intents.push({
            ...data,
            timestamp: new Date(),
            id: this.generateId()
        });
        this.upgradeIntents.set(fingerprint, intents);
        
        // è®°å½•åˆ°ç»Ÿè®¡æ•°æ®
        this.recordEvent(fingerprint, {
            type: 'upgrade_intent',
            tier: data.targetTier,
            email: data.email
        });
    }
    
    // æ–°å¢ï¼šæ¨¡æ‹Ÿå‡çº§ï¼ˆéªŒè¯æœŸç”¨ï¼‰
    simulateUpgrade(fingerprint, tier, duration = 24 * 60 * 60 * 1000) {
        this.userTiers.set(fingerprint, {
            tier: tier,
            expiry: Date.now() + duration,
            simulated: true
        });
    }
    
    // æ–°å¢ï¼šè·å–å‡çº§æ„æ„¿ç»Ÿè®¡
    getUpgradeIntentStats() {
        let totalIntents = 0;
        let tierBreakdown = { standard: 0, premium: 0 };
        let emailsCollected = 0;
        
        for (let [fingerprint, intents] of this.upgradeIntents) {
            totalIntents += intents.length;
            
            intents.forEach(intent => {
                tierBreakdown[intent.targetTier] = (tierBreakdown[intent.targetTier] || 0) + 1;
                if (intent.email) emailsCollected++;
            });
        }
        
        return {
            totalIntents,
            tierBreakdown,
            emailsCollected,
            conversionRate: totalIntents > 0 ? (emailsCollected / totalIntents * 100).toFixed(2) : 0
        };
    }
}
```

### 2.3 æŠ¥å‘Šç”Ÿæˆåˆ†çº§é€»è¾‘

**æŠ¥å‘Šæ ¼å¼æ§åˆ¶ï¼š**

```javascript
// æŠ¥å‘Šç”Ÿæˆå™¨å‡çº§
class ReportGenerator {
    generateReport(analysis, tier, language = 'zh') {
        const config = TIER_CONFIG[tier];
        
        // åŸºç¡€æŠ¥å‘Šç»“æ„ï¼ˆæ‰€æœ‰çº§åˆ«ï¼‰
        const baseReport = {
            id: this.generateReportId(),
            timestamp: new Date().toISOString(),
            tier: tier,
            language: language,
            summary: analysis.summary,
            overallGrade: analysis.overallGrade
        };
        
        // æ ¹æ®çº§åˆ«ç”Ÿæˆä¸åŒå†…å®¹
        switch(tier) {
            case 'free':
                return this.generateFreeReport(baseReport, analysis);
            case 'standard':
                return this.generateStandardReport(baseReport, analysis);
            case 'premium':
                return this.generatePremiumReport(baseReport, analysis);
        }
    }
    
    generateFreeReport(baseReport, analysis) {
        return {
            ...baseReport,
            problems: analysis.problems.slice(0, 3).map(p => ({
                title: p.title,
                severity: p.severity,
                description: p.description,
                quickFix: p.solutions[0] // åªæ˜¾ç¤ºç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ
            })),
            limitations: {
                shown: 3,
                total: analysis.problems.length,
                message: `å‘ç°${analysis.problems.length}ä¸ªé£æ°´é—®é¢˜ï¼Œå½“å‰ä»…æ˜¾ç¤ºæœ€é‡è¦çš„3ä¸ª`
            },
            upgradePrompt: analysis.upgradePrompt
        };
    }
    
    generateStandardReport(baseReport, analysis) {
        return {
            ...baseReport,
            problems: analysis.problems.map(p => ({
                title: p.title,
                severity: p.severity,
                description: p.description,
                solutions: p.solutions.slice(0, 3), // æ˜¾ç¤º3ä¸ªè§£å†³æ–¹æ¡ˆ
                impact: p.impact,
                urgency: p.urgency
            })),
            roomScores: analysis.scores,
            recommendations: this.generateRecommendations(analysis),
            downloadUrl: `/api/reports/${baseReport.id}/pdf`,
            upgradePrompt: analysis.upgradePrompt // æç¤ºå‡çº§åˆ°Premium
        };
    }
    
    generatePremiumReport(baseReport, analysis) {
        return {
            ...baseReport,
            problems: analysis.problems.map(p => ({
                title: p.title,
                severity: p.severity,
                description: p.description,
                solutions: p.solutions, // æ˜¾ç¤ºæ‰€æœ‰è§£å†³æ–¹æ¡ˆ
                impact: p.impact,
                urgency: p.urgency,
                personalizedNote: p.personalizedNote
            })),
            roomScores: analysis.scores,
            personalizedAdvice: analysis.personalizedAdvice,
            actionPlan: analysis.actionPlan,
            recommendations: this.generateAdvancedRecommendations(analysis),
            downloadUrl: `/api/reports/${baseReport.id}/pdf`,
            consultationInfo: {
                available: true,
                contact: process.env.CONSULTATION_EMAIL,
                note: "Premiumç”¨æˆ·äº«æœ‰ä¸“å±å’¨è¯¢æœåŠ¡"
            }
        };
    }
}
```

### 2.4 å‰ç«¯äº¤äº’ç•Œé¢å®ç°

**å‡çº§æç¤ºUIç»„ä»¶ï¼š**

```html
<!-- å‡çº§æç¤ºç»„ä»¶ -->
<div id="upgrade-prompt" class="upgrade-prompt" style="display: none;">
    <div class="upgrade-content">
        <h3 class="upgrade-title"></h3>
        <ul class="upgrade-features"></ul>
        <div class="upgrade-actions">
            <button class="upgrade-btn primary" onclick="handleUpgrade()">
                <span class="btn-text"></span>
            </button>
            <button class="upgrade-btn secondary" onclick="closeUpgradePrompt()">
                ç¨åå†è¯´
            </button>
        </div>
        <p class="upgrade-note"></p>
    </div>
</div>
```

```javascript
// å‡çº§æç¤ºJavaScript
function showUpgradePrompt(promptData, currentTier) {
    const prompt = document.getElementById('upgrade-prompt');
    const title = prompt.querySelector('.upgrade-title');
    const features = prompt.querySelector('.upgrade-features');
    const btnText = prompt.querySelector('.btn-text');
    const note = prompt.querySelector('.upgrade-note');
    
    // å¡«å……å†…å®¹
    title.textContent = promptData.title;
    btnText.textContent = promptData.cta;
    note.textContent = promptData.note || '';
    
    // æ¸…ç©ºå¹¶å¡«å……åŠŸèƒ½åˆ—è¡¨
    features.innerHTML = '';
    promptData.features.forEach(feature => {
        const li = document.createElement('li');
        li.textContent = feature;
        features.appendChild(li);
    });
    
    // æ˜¾ç¤ºæç¤ºæ¡†
    prompt.style.display = 'block';
    prompt.dataset.targetTier = currentTier === 'free' ? 'standard' : 'premium';
}

async function handleUpgrade() {
    const prompt = document.getElementById('upgrade-prompt');
    const targetTier = prompt.dataset.targetTier;
    
    // éªŒè¯æœŸé—´ï¼šæ”¶é›†é‚®ç®±å¹¶æ¨¡æ‹Ÿå‡çº§
    if (isValidationMode()) {
        const email = await collectEmail(targetTier);
        if (email) {
            await simulateUpgrade(targetTier, email);
        }
    } else {
        // æ­£å¼æ¨¡å¼ï¼šè·³è½¬åˆ°æ”¯ä»˜é¡µé¢
        window.location.href = `/payment?tier=${targetTier}`;
    }
}

async function collectEmail(targetTier) {
    return new Promise((resolve) => {
        const email = prompt(`æ„Ÿè°¢æ‚¨çš„å…³æ³¨ï¼è¯·ç•™ä¸‹é‚®ç®±ï¼Œ${targetTier === 'standard' ? 'æ ‡å‡†ç‰ˆ' : 'å®šåˆ¶ç‰ˆ'}å¼€æ”¾æ—¶ç¬¬ä¸€æ—¶é—´é€šçŸ¥æ‚¨ï¼š`);
        
        if (email && validateEmail(email)) {
            // è®°å½•å‡çº§æ„æ„¿
            fetch('/api/upgrade-intent', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    tier: targetTier,
                    email: email
                })
            });
            resolve(email);
        } else {
            resolve(null);
        }
    });
}
```

## 3. æ•°æ®åº“è®¾è®¡æ–¹æ¡ˆ

### 3.1 ç”¨æˆ·æ•°æ®è¡¨è®¾è®¡

**è€ƒè™‘åˆ°å½“å‰ç³»ç»Ÿä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œè®¾è®¡å…¼å®¹çš„æ•°æ®ç»“æ„ï¼š**

```javascript
// ç”¨æˆ·æ•°æ®ç»“æ„ï¼ˆå½“å‰å†…å­˜å­˜å‚¨ï¼‰
const UserSchema = {
    fingerprint: String,        // ç”¨æˆ·æŒ‡çº¹IDï¼ˆä¸»é”®ï¼‰
    createdAt: Date,           // é¦–æ¬¡è®¿é—®æ—¶é—´
    lastUsed: Date,            // æœ€åä½¿ç”¨æ—¶é—´
    usageCount: Number,        // ä½¿ç”¨æ¬¡æ•°
    region: String,            // åœ°ç†åŒºåŸŸ
    language: String,          // è¯­è¨€åå¥½
    metadata: Array,           // ä½¿ç”¨å…ƒæ•°æ®
    tier: String,              // ç”¨æˆ·ç­‰çº§ (free/standard/premium)
    subscription: {            // è®¢é˜…ä¿¡æ¯
        active: Boolean,
        expiry: Date,
        orderId: String
    }
};

// å‡çº§æ„æ„¿è®°å½•ç»“æ„
const UpgradeIntentSchema = {
    id: String,                // è®°å½•ID
    fingerprint: String,       // ç”¨æˆ·æŒ‡çº¹
    targetTier: String,        // ç›®æ ‡ç­‰çº§
    email: String,             // ç”¨æˆ·é‚®ç®±
    timestamp: Date,           // è®°å½•æ—¶é—´
    simulated: Boolean,        // æ˜¯å¦ä¸ºæ¨¡æ‹Ÿå‡çº§
    converted: Boolean,        // æ˜¯å¦æœ€ç»ˆè½¬åŒ–
    conversionDate: Date       // è½¬åŒ–æ—¥æœŸ
};
```

### 3.2 åˆ†æè®°å½•è¡¨è®¾è®¡

```javascript
// åˆ†æè®°å½•æ•°æ®ç»“æ„
const AnalysisSchema = {
    id: String,                // åˆ†æè®°å½•ID
    fingerprint: String,       // ç”¨æˆ·æŒ‡çº¹
    tier: String,              // ä½¿ç”¨çš„äº§å“ç­‰çº§
    timestamp: Date,           // åˆ†ææ—¶é—´
    inputData: {               // è¾“å…¥æ•°æ®
        houseType: String,
        direction: String,
        hasPhoto: Boolean,
        photoName: String,
        additionalInfo: Object
    },
    results: {                 // åˆ†æç»“æœ
        overallGrade: Number,
        problems: Array,
        scores: Object,
        aiProvider: String,    // ä½¿ç”¨çš„AIæä¾›å•†
        processingTime: Number // å¤„ç†æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    },
    userFeedback: {           // ç”¨æˆ·åé¦ˆ
        rating: Number,
        comment: String,
        feedbackDate: Date
    }
};
```

### 3.3 ä»˜è´¹è®°å½•è¡¨è®¾è®¡

```javascript
// è®¢å•è®°å½•æ•°æ®ç»“æ„ï¼ˆä¸ºå•†ä¸šåŒ–å‡†å¤‡ï¼‰
const OrderSchema = {
    orderId: String,           // è®¢å•ID
    fingerprint: String,       // ç”¨æˆ·æŒ‡çº¹
    email: String,             // ç”¨æˆ·é‚®ç®±
    tier: String,              // è´­ä¹°ç­‰çº§
    amount: Number,            // æ”¯ä»˜é‡‘é¢
    currency: String,          // è´§å¸ç±»å‹
    status: String,            // è®¢å•çŠ¶æ€ (pending/paid/failed/refunded)
    paymentProvider: String,   // æ”¯ä»˜æä¾›å•†
    paymentId: String,         // æ”¯ä»˜æµæ°´å·
    createdAt: Date,           // è®¢å•åˆ›å»ºæ—¶é—´
    paidAt: Date,              // æ”¯ä»˜å®Œæˆæ—¶é—´
    expiryAt: Date,            // æœåŠ¡åˆ°æœŸæ—¶é—´
    refundedAt: Date           // é€€æ¬¾æ—¶é—´
};
```

### 3.4 æ•°æ®å…³ç³»å’Œç´¢å¼•ä¼˜åŒ–

```javascript
// æ•°æ®ç®¡ç†å™¨ï¼ˆç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ•°æ®ç»“æ„ï¼‰
class DataManager {
    constructor() {
        // ä¸»è¦æ•°æ®å­˜å‚¨
        this.users = new Map();           // fingerprint -> UserSchema
        this.analyses = new Map();        // analysisId -> AnalysisSchema  
        this.upgradeIntents = new Map();  // fingerprint -> [UpgradeIntentSchema]
        this.orders = new Map();          // orderId -> OrderSchema
        
        // ç´¢å¼•ï¼ˆæå‡æŸ¥è¯¢æ€§èƒ½ï¼‰
        this.usersByRegion = new Map();   // region -> [fingerprint]
        this.analysesByDate = new Map();  // dateString -> [analysisId]
        this.ordersByUser = new Map();    // fingerprint -> [orderId]
    }
    
    // ç”¨æˆ·ç›¸å…³æ“ä½œ
    createUser(fingerprint, metadata) {
        const user = {
            fingerprint,
            createdAt: new Date(),
            lastUsed: new Date(),
            usageCount: 1,
            region: metadata.region || 'unknown',
            language: metadata.language || 'zh',
            metadata: [metadata],
            tier: 'free',
            subscription: {
                active: false,
                expiry: null,
                orderId: null
            }
        };
        
        this.users.set(fingerprint, user);
        this.updateUserIndex(user);
        return user;
    }
    
    // åˆ†æè®°å½•æ“ä½œ
    saveAnalysis(fingerprint, tier, inputData, results) {
        const analysisId = this.generateId();
        const analysis = {
            id: analysisId,
            fingerprint,
            tier,
            timestamp: new Date(),
            inputData,
            results,
            userFeedback: null
        };
        
        this.analyses.set(analysisId, analysis);
        this.updateAnalysisIndex(analysis);
        return analysisId;
    }
    
    // æŸ¥è¯¢æ–¹æ³•
    getAnalysesByUser(fingerprint, limit = 10) {
        const userAnalyses = [];
        for (let [id, analysis] of this.analyses) {
            if (analysis.fingerprint === fingerprint) {
                userAnalyses.push(analysis);
            }
        }
        return userAnalyses
            .sort((a, b) => b.timestamp - a.timestamp)
            .slice(0, limit);
    }
    
    getAnalyticsSummary() {
        const today = new Date().toDateString();
        const todayAnalyses = this.analysesByDate.get(today) || [];
        
        return {
            totalUsers: this.users.size,
            totalAnalyses: this.analyses.size,
            todayAnalyses: todayAnalyses.length,
            upgradeIntents: Array.from(this.upgradeIntents.values()).reduce((sum, intents) => sum + intents.length, 0),
            tierDistribution: this.getTierDistribution()
        };
    }
}
```

## 4. APIæ¥å£è®¾è®¡

### 4.1 åˆ†æè¯·æ±‚æ¥å£å‡çº§

**ç°æœ‰æ¥å£ï¼š** `POST /api/analyze`

**å‡çº§æ”¹é€ ï¼š**

```javascript
// å‡çº§åçš„åˆ†ææ¥å£
app.post('/api/analyze', upload.single('photo'), async (req, res) => {
    try {
        const fingerprint = userManager.generateFingerprint(req);
        
        // 1. è·å–ç”¨æˆ·ç­‰çº§
        const userTier = userManager.getUserTier(fingerprint);
        const requestedTier = req.body.tier || userTier;
        
        // 2. éªŒè¯ç­‰çº§æƒé™
        if (!userManager.hasAccess(fingerprint, requestedTier)) {
            return res.status(403).json({
                success: false,
                error: 'ç­‰çº§æƒé™ä¸è¶³',
                currentTier: userTier,
                requiredTier: requestedTier
            });
        }
        
        // 3. å‡†å¤‡åˆ†ææ•°æ®
        const formData = {
            houseType: req.body.houseType || req.body.roomType,
            direction: req.body.direction,
            // ... å…¶ä»–ç°æœ‰å­—æ®µä¿æŒä¸å˜
            photo: req.file ? req.file.filename : null
        };
        
        // 4. æ‰§è¡Œåˆ†æï¼ˆæ·»åŠ tierå‚æ•°ï¼‰
        const language = req.body.language || 'zh';
        let analysisResult;
        
        if (validateConfig()) {
            analysisResult = await analyzer.analyze(formData, language, requestedTier);
        } else {
            analysisResult = analyzer.generateSampleAnalysis(formData, language, requestedTier);
        }
        
        // 5. è®°å½•åˆ†ææ•°æ®
        const analysisId = dataManager.saveAnalysis(fingerprint, requestedTier, formData, analysisResult);
        userManager.recordUsage(fingerprint, {
            tier: requestedTier,
            hasImage: !!req.file,
            analysisId: analysisId
        });
        
        // 6. ç”ŸæˆæŠ¥å‘Š
        const report = reportGenerator.generateReport(analysisResult, requestedTier, language);
        
        res.json({
            success: true,
            data: {
                ...report,
                analysisId: analysisId,
                userTier: userTier
            }
        });
        
    } catch (error) {
        console.error('âŒ åˆ†æè¯·æ±‚å¤±è´¥:', error);
        res.status(500).json({
            success: false,
            error: error.message
        });
    }
});
```

### 4.2 ç”¨æˆ·çŠ¶æ€æŸ¥è¯¢æ¥å£

**æ–°å¢æ¥å£ï¼š** `GET /api/user-status`

```javascript
app.get('/api/user-status', (req, res) => {
    try {
        const fingerprint = userManager.generateFingerprint(req);
        const user = userManager.getUser(fingerprint);
        
        if (!user) {
            return res.json({
                success: true,
                data: {
                    isNew: true,
                    tier: 'free',
                    usageCount: 0
                }
            });
        }
        
        const recentAnalyses = dataManager.getAnalysesByUser(fingerprint, 5);
        const upgradeIntents = userManager.getUpgradeIntents(fingerprint);
        
        res.json({
            success: true,
            data: {
                fingerprint: fingerprint,
                tier: user.tier,
                usageCount: user.usageCount,
                lastUsed: user.lastUsed,
                region: user.region,
                language: user.language,
                subscription: user.subscription,
                recentAnalyses: recentAnalyses.map(a => ({
                    id: a.id,
                    tier: a.tier,
                    timestamp: a.timestamp,
                    overallGrade: a.results.overallGrade
                })),
                upgradeIntents: upgradeIntents.length,
                canUpgrade: this.canUserUpgrade(user.tier)
            }
        });
        
    } catch (error) {
        console.error('è·å–ç”¨æˆ·çŠ¶æ€å¤±è´¥:', error);
        res.status(500).json({
            success: false,
            error: 'è·å–ç”¨æˆ·çŠ¶æ€å¤±è´¥'
        });
    }
});

// è¾…åŠ©æ–¹æ³•
function canUserUpgrade(currentTier) {
    return {
        toStandard: currentTier === 'free',
        toPremium: ['free', 'standard'].includes(currentTier)
    };
}
```

### 4.3 å‡çº§æ„æ„¿æ”¶é›†æ¥å£

**æ–°å¢æ¥å£ï¼š** `POST /api/upgrade-intent`

```javascript
app.post('/api/upgrade-intent', async (req, res) => {
    try {
        const { tier, email, simulate = false } = req.body;
        const fingerprint = userManager.generateFingerprint(req);
        
        // éªŒè¯è¾“å…¥
        if (!['standard', 'premium'].includes(tier)) {
            return res.status(400).json({
                success: false,
                error: 'æ— æ•ˆçš„ç­‰çº§é€‰æ‹©'
            });
        }
        
        if (!email || !validateEmail(email)) {
            return res.status(400).json({
                success: false,
                error: 'è¯·æä¾›æœ‰æ•ˆçš„é‚®ç®±åœ°å€'
            });
        }
        
        // è®°å½•å‡çº§æ„æ„¿
        userManager.recordUpgradeIntent(fingerprint, {
            targetTier: tier,
            email: email,
            simulated: simulate
        });
        
        let responseData = {
            success: true,
            message: 'æ„Ÿè°¢æ‚¨çš„å…³æ³¨ï¼',
            tier: tier
        };
        
        // éªŒè¯æœŸï¼šæ¨¡æ‹Ÿå‡çº§ä½“éªŒ
        if (simulate && process.env.VALIDATION_MODE === 'true') {
            userManager.simulateUpgrade(fingerprint, tier);
            
            responseData.upgraded = true;
            responseData.message = `å·²ä¸ºæ‚¨å¼€é€š${tier === 'standard' ? 'æ ‡å‡†ç‰ˆ' : 'å®šåˆ¶ç‰ˆ'}24å°æ—¶ä½“éªŒï¼`;
            responseData.expiryHours = 24;
            
            // å‘é€ä½“éªŒé“¾æ¥
            if (email) {
                await sendExperienceEmail(email, tier, fingerprint);
            }
        } else {
            // æ­£å¼æ¨¡å¼ï¼šå‘é€å¼€æ”¾é€šçŸ¥é‚®ä»¶
            responseData.message = 'å¼€æ”¾æ—¶å°†ç¬¬ä¸€æ—¶é—´é€šçŸ¥æ‚¨ï¼';
            responseData.eta = 'é¢„è®¡2-4å‘¨å†…å¼€æ”¾';
        }
        
        res.json(responseData);
        
    } catch (error) {
        console.error('è®°å½•å‡çº§æ„æ„¿å¤±è´¥:', error);
        res.status(500).json({
            success: false,
            error: 'è®°å½•å‡çº§æ„æ„¿å¤±è´¥'
        });
    }
});
```

### 4.4 æ•°æ®ç»Ÿè®¡æ¥å£

**æ–°å¢æ¥å£ï¼š** `GET /api/analytics-dashboard`

```javascript
app.get('/api/analytics-dashboard', (req, res) => {
    try {
        // ä»…åœ¨å¼€å‘æ¨¡å¼æˆ–ç®¡ç†å‘˜æƒé™ä¸‹å¯è®¿é—®
        if (process.env.NODE_ENV === 'production' && !req.headers['admin-key']) {
            return res.status(403).json({
                success: false,
                error: 'è®¿é—®æƒé™ä¸è¶³'
            });
        }
        
        const analytics = dataManager.getAnalyticsSummary();
        const upgradeStats = userManager.getUpgradeIntentStats();
        const aiStats = analyzer.aiManager.getPerformanceStats();
        
        res.json({
            success: true,
            data: {
                overview: analytics,
                conversion: {
                    ...upgradeStats,
                    conversionFunnel: this.getConversionFunnel()
                },
                technical: {
                    ai: aiStats,
                    system: {
                        uptime: process.uptime(),
                        memory: process.memoryUsage(),
                        timestamp: new Date().toISOString()
                    }
                },
                trends: this.getTrendData()
            }
        });
        
    } catch (error) {
        console.error('è·å–åˆ†ææ•°æ®å¤±è´¥:', error);
        res.status(500).json({
            success: false,
            error: 'è·å–åˆ†ææ•°æ®å¤±è´¥'
        });
    }
});
```

## 5. éªŒè¯æœŸç‰¹æ®ŠåŠŸèƒ½

### 5.1 "ä¼ªä»˜è´¹"åŠŸèƒ½å®ç°

**æ ¸å¿ƒè®¾è®¡æ€è·¯ï¼š**
è®©ç”¨æˆ·ä½“éªŒå®Œæ•´çš„ä»˜è´¹æµç¨‹ï¼Œä½†å®é™…ä¸æ”¶è´¹ï¼ŒåŒæ—¶æ”¶é›†ä»˜è´¹æ„æ„¿æ•°æ®ã€‚

```javascript
// éªŒè¯æœŸæ”¯ä»˜æ¨¡æ‹Ÿå™¨
class ValidationPaymentSimulator {
    constructor() {
        this.simulatedTransactions = new Map();
        this.userExperiences = new Map();
    }
    
    // æ¨¡æ‹Ÿæ”¯ä»˜æµç¨‹
    async simulatePayment(fingerprint, tier, email) {
        const transactionId = this.generateTransactionId();
        const amount = this.getTierPrice(tier);
        
        // 1. åˆ›å»ºæ¨¡æ‹Ÿè®¢å•
        const simulatedOrder = {
            id: transactionId,
            fingerprint: fingerprint,
            email: email,
            tier: tier,
            amount: amount,
            currency: 'USD',
            status: 'simulated_success',
            createdAt: new Date(),
            validUntil: new Date(Date.now() + 24 * 60 * 60 * 1000) // 24å°æ—¶
        };
        
        this.simulatedTransactions.set(transactionId, simulatedOrder);
        
        // 2. ç»™ç”¨æˆ·ä¸´æ—¶é«˜çº§æƒé™
        this.grantTemporaryAccess(fingerprint, tier, 24);
        
        // 3. è®°å½•ç”¨æˆ·ä»˜è´¹æ„æ„¿
        this.recordPaymentIntent(fingerprint, {
            tier: tier,
            amount: amount,
            email: email,
            timestamp: new Date(),
            transactionId: transactionId
        });
        
        return {
            success: true,
            transactionId: transactionId,
            message: 'éªŒè¯æœŸå…è´¹ä½“éªŒ24å°æ—¶ï¼',
            tier: tier,
            validUntil: simulatedOrder.validUntil,
            note: 'æ­£å¼ç‰ˆæœ¬å°†æ”¶è´¹ï¼Œæ„Ÿè°¢æ‚¨çš„æµ‹è¯•ï¼'
        };
    }
    
    // æˆäºˆä¸´æ—¶è®¿é—®æƒé™
    grantTemporaryAccess(fingerprint, tier, hours) {
        const expiry = Date.now() + (hours * 60 * 60 * 1000);
        
        this.userExperiences.set(fingerprint, {
            tier: tier,
            expiry: expiry,
            originalTier: 'free',
            isSimulated: true
        });
        
        // æ›´æ–°ç”¨æˆ·ç®¡ç†å™¨ä¸­çš„ç­‰çº§
        userManager.simulateUpgrade(fingerprint, tier, hours * 60 * 60 * 1000);
    }
    
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰ä¸´æ—¶è®¿é—®æƒé™
    checkTemporaryAccess(fingerprint) {
        const experience = this.userExperiences.get(fingerprint);
        
        if (!experience) return null;
        
        if (Date.now() > experience.expiry) {
            // æƒé™å·²è¿‡æœŸï¼Œæ¢å¤åŸç­‰çº§
            this.userExperiences.delete(fingerprint);
            userManager.restoreOriginalTier(fingerprint);
            return null;
        }
        
        return {
            tier: experience.tier,
            timeLeft: Math.max(0, experience.expiry - Date.now()),
            isSimulated: true
        };
    }
}
```

### 5.2 ä»˜è´¹æ„æ„¿æ•°æ®æ”¶é›†

**æ ¸å¿ƒæ•°æ®æ”¶é›†ç­–ç•¥ï¼š**

```javascript
// ä»˜è´¹æ„æ„¿åˆ†æå™¨ï¼ˆç®€åŒ–ç‰ˆï¼‰
class PaymentIntentAnalyzer {
    constructor() {
        this.intents = new Map();
        this.conversions = new Map();
    }
    
    // è®°å½•ä»˜è´¹æ„æ„¿
    recordIntent(fingerprint, data) {
        const intent = {
            id: this.generateId(),
            fingerprint: fingerprint,
            tier: data.tier,
            email: data.email,
            amount: data.amount,
            timestamp: new Date(),
            source: data.source || 'upgrade_prompt'
        };
        
        const userIntents = this.intents.get(fingerprint) || [];
        userIntents.push(intent);
        this.intents.set(fingerprint, userIntents);
        
        return intent.id;
    }
    
    // è·å–ç»Ÿè®¡æ•°æ®
    getIntentStatistics() {
        let totalIntents = 0;
        let uniqueUsers = this.intents.size;
        let emailCollected = 0;
        let tierBreakdown = { standard: 0, premium: 0 };
        
        for (let [fingerprint, intents] of this.intents) {
            totalIntents += intents.length;
            const latestIntent = intents[intents.length - 1];
            if (latestIntent.email) emailCollected++;
            tierBreakdown[latestIntent.tier] = (tierBreakdown[latestIntent.tier] || 0) + 1;
        }
        
        return {
            totalIntents,
            uniqueUsers,
            emailCollected,
            emailConversionRate: uniqueUsers > 0 ? (emailCollected / uniqueUsers * 100).toFixed(2) + '%' : '0%',
            tierBreakdown
        };
    }
}
```

### 5.3 A/Bæµ‹è¯•æ¡†æ¶

**ç®€åŒ–A/Bæµ‹è¯•å®ç°ï¼š**

```javascript
// A/Bæµ‹è¯•ç®¡ç†å™¨
class ABTestManager {
    constructor() {
        this.tests = new Map();
        this.assignments = new Map();
        this.results = new Map();
    }
    
    // è·å–ç”¨æˆ·çš„æµ‹è¯•å˜ä½“
    getVariant(fingerprint, testName) {
        const userAssignments = this.assignments.get(fingerprint) || {};
        
        if (userAssignments[testName]) {
            return userAssignments[testName];
        }
        
        // åŸºäºæŒ‡çº¹å“ˆå¸Œåˆ†é…å˜ä½“
        const hash = this.hashFingerprint(fingerprint + testName);
        const variant = hash % 2 === 0 ? 'A' : 'B';
        
        userAssignments[testName] = variant;
        this.assignments.set(fingerprint, userAssignments);
        
        return variant;
    }
    
    // è®°å½•è½¬åŒ–
    recordConversion(fingerprint, testName) {
        const userAssignments = this.assignments.get(fingerprint);
        if (!userAssignments || !userAssignments[testName]) return;
        
        const variant = userAssignments[testName];
        const testResults = this.results.get(testName) || { A: { conversions: 0 }, B: { conversions: 0 } };
        testResults[variant].conversions++;
        this.results.set(testName, testResults);
    }
}
```

### 5.4 ç”¨æˆ·è¡Œä¸ºè¿½è¸ª

**è¡Œä¸ºæ•°æ®æ”¶é›†ï¼š**

```javascript
// ç”¨æˆ·è¡Œä¸ºè¿½è¸ªå™¨ï¼ˆç®€åŒ–ç‰ˆï¼‰
class UserBehaviorTracker {
    constructor() {
        this.events = new Map();
        this.sessions = new Map();
    }
    
    // è®°å½•ç”¨æˆ·äº‹ä»¶
    trackEvent(fingerprint, eventType, eventData = {}) {
        const userEvents = this.events.get(fingerprint) || [];
        const event = {
            type: eventType,
            timestamp: Date.now(),
            data: eventData
        };
        
        userEvents.push(event);
        this.events.set(fingerprint, userEvents);
        
        // å¤„ç†ç‰¹æ®Šäº‹ä»¶
        if (eventType === 'upgrade_button_click') {
            abTestManager.recordConversion(fingerprint, 'upgrade_prompt_text');
        }
    }
    
    // è®¡ç®—ç”¨æˆ·ä»·å€¼è¯„åˆ†
    calculateValueScore(fingerprint) {
        const events = this.events.get(fingerprint) || [];
        let score = 0;
        
        events.forEach(event => {
            switch(event.type) {
                case 'page_view': score += 1; break;
                case 'analyze_complete': score += 10; break;
                case 'upgrade_button_click': score += 20; break;
                case 'email_submitted': score += 50; break;
            }
        });
        
        return Math.min(score, 100);
    }
}
```

## 6. æ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨

### 6.1 ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

**AIè°ƒç”¨ä¼˜åŒ–ï¼š**

```javascript
// AIæ€§èƒ½ä¼˜åŒ–å™¨
class AIPerformanceOptimizer {
    constructor() {
        this.responseCache = new Map();
        this.requestQueue = [];
        this.processing = false;
        this.maxCacheSize = 1000;
        this.cacheTimeout = 3600000; // 1å°æ—¶
    }
    
    // æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ
    getCachedResult(formData) {
        const cacheKey = this.generateCacheKey(formData);
        const cached = this.responseCache.get(cacheKey);
        
        if (!cached) return null;
        
        // æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸ
        if (Date.now() - cached.timestamp > this.cacheTimeout) {
            this.responseCache.delete(cacheKey);
            return null;
        }
        
        return cached.result;
    }
    
    // ç¼“å­˜åˆ†æç»“æœ
    cacheResult(formData, result) {
        const cacheKey = this.generateCacheKey(formData);
        
        // å¦‚æœç¼“å­˜å·²æ»¡ï¼Œåˆ é™¤æœ€æ—§çš„é¡¹ç›®
        if (this.responseCache.size >= this.maxCacheSize) {
            const oldestKey = this.responseCache.keys().next().value;
            this.responseCache.delete(oldestKey);
        }
        
        this.responseCache.set(cacheKey, {
            result: result,
            timestamp: Date.now()
        });
    }
    
    // ç”Ÿæˆç¼“å­˜é”®
    generateCacheKey(formData) {
        const keyData = {
            houseType: formData.houseType,
            direction: formData.direction,
            hasPhoto: !!formData.photo,
            // ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯å¦‚ç”Ÿè¾°å…«å­—
        };
        
        return crypto.createHash('md5').update(JSON.stringify(keyData)).digest('hex');
    }
    
    // è¯·æ±‚é˜Ÿåˆ—ç®¡ç†ï¼ˆé˜²æ­¢å¹¶å‘è¿‡å¤šï¼‰
    async processRequest(analysisFunction, ...args) {
        return new Promise((resolve, reject) => {
            this.requestQueue.push({
                analysisFunction,
                args,
                resolve,
                reject,
                timestamp: Date.now()
            });
            
            this.processQueue();
        });
    }
    
    async processQueue() {
        if (this.processing || this.requestQueue.length === 0) return;
        
        this.processing = true;
        
        while (this.requestQueue.length > 0) {
            const request = this.requestQueue.shift();
            
            try {
                const result = await request.analysisFunction(...request.args);
                request.resolve(result);
            } catch (error) {
                request.reject(error);
            }
            
            // è¯·æ±‚é—´éš”æ§åˆ¶
            await new Promise(resolve => setTimeout(resolve, 200));
        }
        
        this.processing = false;
    }
}
```

**å†…å­˜ç®¡ç†ä¼˜åŒ–ï¼š**

```javascript
// å†…å­˜ç®¡ç†å™¨
class MemoryManager {
    constructor() {
        this.cleanupInterval = setInterval(() => {
            this.performCleanup();
        }, 30 * 60 * 1000); // 30åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡
    }
    
    // å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®
    performCleanup() {
        const now = Date.now();
        const maxAge = 24 * 60 * 60 * 1000; // 24å°æ—¶
        
        // æ¸…ç†è¿‡æœŸçš„ç”¨æˆ·ä¼šè¯
        for (let [fingerprint, session] of behaviorTracker.sessions) {
            if (now - session.lastActivity > maxAge) {
                behaviorTracker.sessions.delete(fingerprint);
            }
        }
        
        // æ¸…ç†è¿‡æœŸçš„æ¨¡æ‹Ÿå‡çº§
        for (let [fingerprint, experience] of validationSimulator.userExperiences) {
            if (now > experience.expiry) {
                validationSimulator.userExperiences.delete(fingerprint);
            }
        }
        
        // æ¸…ç†è¿‡æœŸçš„ç¼“å­˜
        aiOptimizer.cleanExpiredCache();
        
        console.log('ğŸ§¹ å†…å­˜æ¸…ç†å®Œæˆ');
    }
    
    // è·å–å†…å­˜ä½¿ç”¨æƒ…å†µ
    getMemoryUsage() {
        const usage = process.memoryUsage();
        
        return {
            rss: (usage.rss / 1024 / 1024).toFixed(2) + ' MB',
            heapTotal: (usage.heapTotal / 1024 / 1024).toFixed(2) + ' MB',
            heapUsed: (usage.heapUsed / 1024 / 1024).toFixed(2) + ' MB',
            external: (usage.external / 1024 / 1024).toFixed(2) + ' MB'
        };
    }
}
```

### 6.2 æ•°æ®å®‰å…¨å’Œéšç§ä¿æŠ¤

**æ•°æ®åŠ å¯†å’Œè„±æ•ï¼š**

```javascript
// æ•°æ®å®‰å…¨ç®¡ç†å™¨
class DataSecurityManager {
    constructor() {
        this.encryptionKey = process.env.ENCRYPTION_KEY || 'default-key-change-in-production';
        this.saltRounds = 10;
    }
    
    // åŠ å¯†æ•æ„Ÿæ•°æ®
    encryptSensitiveData(data) {
        const cipher = crypto.createCipher('aes-256-cbc', this.encryptionKey);
        let encrypted = cipher.update(JSON.stringify(data), 'utf8', 'hex');
        encrypted += cipher.final('hex');
        return encrypted;
    }
    
    // è§£å¯†æ•æ„Ÿæ•°æ®
    decryptSensitiveData(encryptedData) {
        try {
            const decipher = crypto.createDecipher('aes-256-cbc', this.encryptionKey);
            let decrypted = decipher.update(encryptedData, 'hex', 'utf8');
            decrypted += decipher.final('utf8');
            return JSON.parse(decrypted);
        } catch (error) {
            console.error('è§£å¯†å¤±è´¥:', error);
            return null;
        }
    }
    
    // é‚®ç®±è„±æ•æ˜¾ç¤º
    maskEmail(email) {
        if (!email || !email.includes('@')) return email;
        
        const [username, domain] = email.split('@');
        const maskedUsername = username.length > 2 ? 
            username[0] + '*'.repeat(username.length - 2) + username[username.length - 1] :
            '*'.repeat(username.length);
        
        return `${maskedUsername}@${domain}`;
    }
    
    // æ•°æ®è„±æ•ç”¨äºæ—¥å¿—
    sanitizeDataForLogging(data) {
        const sanitized = { ...data };
        
        if (sanitized.email) {
            sanitized.email = this.maskEmail(sanitized.email);
        }
        
        if (sanitized.birthDate) {
            sanitized.birthDate = '[REDACTED]';
        }
        
        if (sanitized.birthTime) {
            sanitized.birthTime = '[REDACTED]';
        }
        
        return sanitized;
    }
    
    // è‡ªåŠ¨æ•°æ®æ¸…ç†
    scheduleDataCleanup() {
        // æ¯æ—¥å‡Œæ™¨2ç‚¹æ¸…ç†è¿‡æœŸæ•°æ®
        setInterval(() => {
            const now = new Date();
            if (now.getHours() === 2 && now.getMinutes() === 0) {
                this.cleanupExpiredData();
            }
        }, 60000); // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    }
    
    cleanupExpiredData() {
        const cutoff = Date.now() - (30 * 24 * 60 * 60 * 1000); // 30å¤©å‰
        
        // æ¸…ç†æ—§çš„åˆ†æè®°å½•ä¸­çš„æ•æ„Ÿä¿¡æ¯
        for (let [id, analysis] of dataManager.analyses) {
            if (analysis.timestamp < cutoff) {
                // ä¿ç•™ç»Ÿè®¡æ•°æ®ï¼Œåˆ é™¤æ•æ„Ÿä¿¡æ¯
                delete analysis.inputData.birthDate;
                delete analysis.inputData.birthTime;
                delete analysis.inputData.photoName;
            }
        }
        
        console.log('ğŸ”’ æ•æ„Ÿæ•°æ®æ¸…ç†å®Œæˆ');
    }
}
```

### 6.3 ç³»ç»Ÿç›‘æ§å’ŒæŠ¥è­¦

**ç›‘æ§ç³»ç»Ÿï¼š**

```javascript
// ç³»ç»Ÿç›‘æ§å™¨
class SystemMonitor {
    constructor() {
        this.metrics = {
            requests: { total: 0, errors: 0, avgTime: 0 },
            memory: { current: 0, peak: 0 },
            ai: { calls: 0, failures: 0, avgTime: 0 },
            users: { active: 0, total: 0 }
        };
        
        this.alerts = [];
        this.thresholds = {
            memoryUsage: 80, // MB
            errorRate: 5,    // %
            responseTime: 5000 // ms
        };
        
        this.startMonitoring();
    }
    
    // å¼€å§‹ç›‘æ§
    startMonitoring() {
        // æ¯5åˆ†é’Ÿæ”¶é›†ä¸€æ¬¡æŒ‡æ ‡
        setInterval(() => {
            this.collectMetrics();
            this.checkThresholds();
        }, 5 * 60 * 1000);
    }
    
    // æ”¶é›†ç³»ç»ŸæŒ‡æ ‡
    collectMetrics() {
        const memUsage = process.memoryUsage();
        this.metrics.memory.current = memUsage.heapUsed / 1024 / 1024; // MB
        
        if (this.metrics.memory.current > this.metrics.memory.peak) {
            this.metrics.memory.peak = this.metrics.memory.current;
        }
        
        // æ”¶é›†AIæ€§èƒ½æŒ‡æ ‡
        const aiStats = analyzer.aiManager.getPerformanceStats();
        this.metrics.ai = {
            calls: aiStats.deepseek.calls + aiStats.qwen3.calls,
            failures: aiStats.deepseek.errors + aiStats.qwen3.errors,
            avgTime: (aiStats.deepseek.avgTime + aiStats.qwen3.avgTime) / 2
        };
        
        // æ”¶é›†ç”¨æˆ·æŒ‡æ ‡
        this.metrics.users = {
            active: behaviorTracker.sessions.size,
            total: userManager.users.size
        };
    }
    
    // æ£€æŸ¥é˜ˆå€¼å¹¶æŠ¥è­¦
    checkThresholds() {
        const alerts = [];
        
        // å†…å­˜ä½¿ç”¨ç‡æ£€æŸ¥
        if (this.metrics.memory.current > this.thresholds.memoryUsage) {
            alerts.push({
                type: 'memory',
                level: 'warning',
                message: `å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: ${this.metrics.memory.current.toFixed(2)}MB`,
                timestamp: new Date()
            });
        }
        
        // é”™è¯¯ç‡æ£€æŸ¥
        const errorRate = this.metrics.requests.total > 0 ? 
            (this.metrics.requests.errors / this.metrics.requests.total * 100) : 0;
        
        if (errorRate > this.thresholds.errorRate) {
            alerts.push({
                type: 'error_rate',
                level: 'critical',
                message: `é”™è¯¯ç‡è¿‡é«˜: ${errorRate.toFixed(2)}%`,
                timestamp: new Date()
            });
        }
        
        // AIå“åº”æ—¶é—´æ£€æŸ¥
        if (this.metrics.ai.avgTime > this.thresholds.responseTime) {
            alerts.push({
                type: 'ai_performance',
                level: 'warning',
                message: `AIå“åº”æ—¶é—´è¿‡é•¿: ${this.metrics.ai.avgTime}ms`,
                timestamp: new Date()
            });
        }
        
        // å­˜å‚¨æ–°è­¦æŠ¥
        alerts.forEach(alert => {
            this.alerts.push(alert);
            console.warn(`ğŸš¨ ç³»ç»Ÿè­¦æŠ¥ [${alert.level}]: ${alert.message}`);
        });
        
        // ä¿æŒè­¦æŠ¥å†å²åœ¨åˆç†èŒƒå›´å†…
        if (this.alerts.length > 100) {
            this.alerts = this.alerts.slice(-100);
        }
    }
    
    // è·å–ç³»ç»Ÿå¥åº·çŠ¶æ€
    getHealthStatus() {
        const recentAlerts = this.alerts.filter(alert => 
            Date.now() - alert.timestamp.getTime() < 60 * 60 * 1000 // 1å°æ—¶å†…
        );
        
        const criticalAlerts = recentAlerts.filter(alert => alert.level === 'critical');
        
        return {
            status: criticalAlerts.length > 0 ? 'critical' : 
                   recentAlerts.length > 0 ? 'warning' : 'healthy',
            metrics: this.metrics,
            alerts: recentAlerts,
            uptime: process.uptime(),
            timestamp: new Date()
        };
    }
}
```

### 6.4 å¤‡ä»½å’Œæ¢å¤ç­–ç•¥

**æ•°æ®å¤‡ä»½ç³»ç»Ÿï¼š**

```javascript
// æ•°æ®å¤‡ä»½ç®¡ç†å™¨
class BackupManager {
    constructor() {
        this.backupPath = './backups';
        this.scheduleBackups();
    }
    
    // åˆ›å»ºæ•°æ®å¤‡ä»½
    async createBackup() {
        const timestamp = new Date().toISOString().replace(/:/g, '-');
        const backupData = {
            timestamp: timestamp,
            users: Array.from(userManager.users.entries()),
            analyses: Array.from(dataManager.analyses.entries()),
            upgradeIntents: Array.from(paymentIntentAnalyzer.intents.entries()),
            systemStats: systemMonitor.metrics,
            version: '1.0.0'
        };
        
        const filename = `backup-${timestamp}.json`;
        const filepath = `${this.backupPath}/${filename}`;
        
        try {
            // ç¡®ä¿å¤‡ä»½ç›®å½•å­˜åœ¨
            if (!require('fs').existsSync(this.backupPath)) {
                require('fs').mkdirSync(this.backupPath, { recursive: true });
            }
            
            // å†™å…¥å¤‡ä»½æ–‡ä»¶
            require('fs').writeFileSync(filepath, JSON.stringify(backupData, null, 2));
            
            console.log(`ğŸ’¾ æ•°æ®å¤‡ä»½æˆåŠŸ: ${filename}`);
            
            // æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘7å¤©ï¼‰
            this.cleanupOldBackups();
            
            return filename;
        } catch (error) {
            console.error('âŒ å¤‡ä»½å¤±è´¥:', error);
            throw error;
        }
    }
    
    // æ¢å¤æ•°æ®
    async restoreBackup(filename) {
        const filepath = `${this.backupPath}/${filename}`;
        
        try {
            const backupData = JSON.parse(require('fs').readFileSync(filepath, 'utf8'));
            
            // æ¢å¤ç”¨æˆ·æ•°æ®
            userManager.users = new Map(backupData.users);
            
            // æ¢å¤åˆ†ææ•°æ®
            dataManager.analyses = new Map(backupData.analyses);
            
            // æ¢å¤å‡çº§æ„æ„¿æ•°æ®
            paymentIntentAnalyzer.intents = new Map(backupData.upgradeIntents);
            
            console.log(`ğŸ”„ æ•°æ®æ¢å¤æˆåŠŸ: ${filename}`);
            return true;
        } catch (error) {
            console.error('âŒ æ¢å¤å¤±è´¥:', error);
            throw error;
        }
    }
    
    // å®šæœŸå¤‡ä»½
    scheduleBackups() {
        // æ¯6å°æ—¶å¤‡ä»½ä¸€æ¬¡
        setInterval(() => {
            this.createBackup().catch(error => {
                console.error('å®šæœŸå¤‡ä»½å¤±è´¥:', error);
            });
        }, 6 * 60 * 60 * 1000);
    }
    
    // æ¸…ç†æ—§å¤‡ä»½
    cleanupOldBackups() {
        try {
            const files = require('fs').readdirSync(this.backupPath);
            const cutoff = Date.now() - (7 * 24 * 60 * 60 * 1000); // 7å¤©å‰
            
            files.forEach(file => {
                if (file.startsWith('backup-')) {
                    const filepath = `${this.backupPath}/${file}`;
                    const stats = require('fs').statSync(filepath);
                    
                    if (stats.mtime.getTime() < cutoff) {
                        require('fs').unlinkSync(filepath);
                        console.log(`ğŸ—‘ï¸ åˆ é™¤æ—§å¤‡ä»½: ${file}`);
                    }
                }
            });
        } catch (error) {
            console.error('æ¸…ç†å¤‡ä»½å¤±è´¥:', error);
        }
    }
}
```

## 7. éƒ¨ç½²å’Œè¿ç»´

### 7.1 å¼€å‘ç¯å¢ƒé…ç½®

**æœ¬åœ°å¼€å‘ç¯å¢ƒè®¾ç½®ï¼š**

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd fengshui-website

# 2. å®‰è£…ä¾èµ–
npm install

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp example.env .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œæ·»åŠ APIå¯†é’¥

# 4. éªŒè¯é…ç½®
node -e "require('./config.js').validateConfig()"

# 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

**ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿ï¼š**

```bash
# .env æ–‡ä»¶æ¨¡æ¿
# AIæœåŠ¡é…ç½®
DEEPSEEK_API_KEY=your-deepseek-api-key
QWEN3_API_KEY=your-qwen3-api-key

# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=development

# éªŒè¯æœŸé…ç½®
VALIDATION_MODE=true
ENABLE_PAYMENT=false
COLLECT_EMAILS=true

# å®‰å…¨é…ç½®
ENCRYPTION_KEY=your-encryption-key-change-in-production
ADMIN_KEY=your-admin-dashboard-key

# å¯é€‰é…ç½®
MAX_FREE_USAGE=999999
CONSULTATION_EMAIL=support@yoursite.com
```

### 7.2 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

**éƒ¨ç½²å‡†å¤‡æ¸…å•ï¼š**

```javascript
// ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•
const PRODUCTION_CHECKLIST = {
    security: [
        'æ›´æ–°æ‰€æœ‰é»˜è®¤å¯†ç å’Œå¯†é’¥',
        'å¯ç”¨HTTPSè¯ä¹¦',
        'é…ç½®é˜²ç«å¢™è§„åˆ™',
        'è®¾ç½®è®¿é—®æ—¥å¿—',
        'å¯ç”¨è¯·æ±‚é™åˆ¶'
    ],
    performance: [
        'é…ç½®CDNåŠ é€Ÿ',
        'å¯ç”¨Gzipå‹ç¼©',
        'ä¼˜åŒ–å›¾ç‰‡èµ„æº',
        'é…ç½®ç¼“å­˜ç­–ç•¥',
        'è®¾ç½®è´Ÿè½½å‡è¡¡ï¼ˆå¦‚éœ€è¦ï¼‰'
    ],
    monitoring: [
        'é…ç½®ç³»ç»Ÿç›‘æ§',
        'è®¾ç½®é”™è¯¯æŠ¥è­¦',
        'å¯ç”¨æ—¥å¿—æ”¶é›†',
        'é…ç½®å¤‡ä»½ç­–ç•¥',
        'æµ‹è¯•æ¢å¤æµç¨‹'
    ],
    business: [
        'é…ç½®æ”¯ä»˜ç³»ç»Ÿï¼ˆå•†ä¸šåŒ–æ—¶ï¼‰',
        'è®¾ç½®é‚®ä»¶æœåŠ¡',
        'é…ç½®åŸŸåå’ŒSSL',
        'å‡†å¤‡å®¢æœè”ç³»æ–¹å¼',
        'æ³•å¾‹åˆè§„æ–‡æ¡£'
    ]
};
```

**Dockeréƒ¨ç½²æ–¹æ¡ˆï¼š**

```dockerfile
# Dockerfile
FROM node:18-alpine

WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY package*.json ./
RUN npm ci --only=production

# å¤åˆ¶æºä»£ç 
COPY . .

# åˆ›å»ºå¿…è¦çš„ç›®å½•
RUN mkdir -p uploads backups logs

# è®¾ç½®æƒé™
RUN chown -R node:node /app
USER node

# æš´éœ²ç«¯å£
EXPOSE 3000

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:3000/api/health || exit 1

# å¯åŠ¨åº”ç”¨
CMD ["npm", "start"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  fengshui-app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
      - QWEN3_API_KEY=${QWEN3_API_KEY}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY}
    volumes:
      - ./uploads:/app/uploads
      - ./backups:/app/backups
      - ./logs:/app/logs
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - fengshui-app
    restart: unless-stopped
```

### 7.3 CI/CDæµç¨‹è®¾è®¡

**GitHub Actionså·¥ä½œæµï¼š**

```yaml
# .github/workflows/deploy.yml
name: Deploy to Production

on:
  push:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run basic tests
      run: |
        node -e "console.log('Basic syntax check passed')"
        node -e "require('./config.js')"
        node -e "require('./server.js')" &
        sleep 5
        curl -f http://localhost:3000/api/health || exit 1

  deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Deploy to server
      uses: appleboy/ssh-action@v0.1.5
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.SSH_KEY }}
        script: |
          cd /var/www/fengshui-website
          git pull origin main
          npm ci --only=production
          pm2 reload ecosystem.config.js
```

### 7.4 ç›‘æ§å’Œæ—¥å¿—ç®¡ç†

**æ—¥å¿—ç®¡ç†ç³»ç»Ÿï¼š**

```javascript
// æ—¥å¿—ç®¡ç†å™¨
class LogManager {
    constructor() {
        this.logPath = './logs';
        this.maxLogSize = 10 * 1024 * 1024; // 10MB
        this.maxLogFiles = 5;
        this.setupLogRotation();
    }
    
    // è®°å½•ä¸åŒçº§åˆ«çš„æ—¥å¿—
    log(level, message, metadata = {}) {
        const timestamp = new Date().toISOString();
        const logEntry = {
            timestamp,
            level,
            message,
            metadata: this.sanitizeMetadata(metadata),
            pid: process.pid
        };
        
        // å†™å…¥æ–‡ä»¶
        this.writeToFile(level, JSON.stringify(logEntry) + '\n');
        
        // æ§åˆ¶å°è¾“å‡ºï¼ˆå¼€å‘æ¨¡å¼ï¼‰
        if (process.env.NODE_ENV !== 'production') {
            console.log(`[${timestamp}] ${level.toUpperCase()}: ${message}`);
        }
    }
    
    info(message, metadata) { this.log('info', message, metadata); }
    warn(message, metadata) { this.log('warn', message, metadata); }
    error(message, metadata) { this.log('error', message, metadata); }
    
    // è„±æ•å¤„ç†
    sanitizeMetadata(metadata) {
        const sanitized = { ...metadata };
        
        // ç§»é™¤æ•æ„Ÿä¿¡æ¯
        const sensitiveKeys = ['password', 'token', 'apiKey', 'birthDate', 'birthTime'];
        sensitiveKeys.forEach(key => {
            if (sanitized[key]) {
                sanitized[key] = '[REDACTED]';
            }
        });
        
        return sanitized;
    }
    
    // æ—¥å¿—è½®è½¬
    setupLogRotation() {
        setInterval(() => {
            this.rotateLogsIfNeeded();
        }, 60 * 60 * 1000); // æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡
    }
}
```

**æ€§èƒ½ç›‘æ§ä»ªè¡¨æ¿ï¼š**

```javascript
// ç›‘æ§ä»ªè¡¨æ¿æ•°æ®æä¾›è€…
class MonitoringDashboard {
    constructor() {
        this.startTime = Date.now();
        this.metrics = {
            requests: new Map(), // endpoint -> count
            errors: new Map(),   // error type -> count
            performance: new Map(), // operation -> avg time
            users: new Map()     // daily active users
        };
    }
    
    // ç”Ÿæˆç›‘æ§æŠ¥å‘Š
    generateReport() {
        const uptime = Date.now() - this.startTime;
        const memUsage = process.memoryUsage();
        
        return {
            system: {
                uptime: this.formatUptime(uptime),
                memory: {
                    used: `${(memUsage.heapUsed / 1024 / 1024).toFixed(2)} MB`,
                    total: `${(memUsage.heapTotal / 1024 / 1024).toFixed(2)} MB`
                },
                cpu: process.cpuUsage(),
                version: process.version
            },
            business: {
                totalUsers: userManager.users.size,
                todayAnalyses: this.getTodayAnalysesCount(),
                upgradeIntents: paymentIntentAnalyzer.getIntentStatistics().totalIntents,
                conversionRate: this.calculateConversionRate()
            },
            technical: {
                aiPerformance: analyzer.aiManager.getPerformanceStats(),
                topErrors: this.getTopErrors(),
                slowestEndpoints: this.getSlowestEndpoints()
            }
        };
    }
    
    // æ ¼å¼åŒ–è¿è¡Œæ—¶é—´
    formatUptime(ms) {
        const seconds = Math.floor(ms / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours = Math.floor(minutes / 60);
        const days = Math.floor(hours / 24);
        
        return `${days}d ${hours % 24}h ${minutes % 60}m ${seconds % 60}s`;
    }
}
```

---

## ğŸ“‹ æŠ€æœ¯å®ç°æ–¹æ¡ˆå®Œæ•´æ‘˜è¦

### ğŸ¯ æ ¸å¿ƒæ¶æ„
- **3æ¡£äº§å“ä½“ç³»**ï¼šå…è´¹ç‰ˆã€æ ‡å‡†ç‰ˆ($19.99)ã€å®šåˆ¶ç‰ˆ($49.99)
- **åŒAIæ¨¡å‹**ï¼šDeepSeek + Qwen3æ™ºèƒ½åˆ‡æ¢
- **æ— æ³¨å†Œç³»ç»Ÿ**ï¼šåŸºäºç”¨æˆ·æŒ‡çº¹è¯†åˆ«
- **éªŒè¯æœŸæ¨¡å¼**ï¼šæ¨¡æ‹Ÿä»˜è´¹æ”¶é›†çœŸå®æ„æ„¿æ•°æ®

### ğŸ”§ ä¸»è¦æŠ€æœ¯ç»„ä»¶
1. **äº§å“åˆ†çº§æ§åˆ¶**ï¼šç»Ÿä¸€AIåˆ†æï¼Œè¾“å‡ºåˆ†çº§è¿‡æ»¤
2. **æƒé™ç®¡ç†ç³»ç»Ÿ**ï¼šéªŒè¯æœŸæ¨¡æ‹Ÿå‡çº§ï¼Œå•†ä¸šåŒ–çœŸå®æƒé™
3. **æ•°æ®æ”¶é›†ä½“ç³»**ï¼šè¡Œä¸ºè¿½è¸ªã€A/Bæµ‹è¯•ã€ä»˜è´¹æ„æ„¿åˆ†æ
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ™ºèƒ½ç¼“å­˜ã€è¯·æ±‚é˜Ÿåˆ—ã€å†…å­˜ç®¡ç†
5. **å®‰å…¨é˜²æŠ¤**ï¼šæ•°æ®åŠ å¯†ã€è„±æ•å¤„ç†ã€è‡ªåŠ¨æ¸…ç†
6. **ç›‘æ§å‘Šè­¦**ï¼šç³»ç»Ÿç›‘æ§ã€æ€§èƒ½åˆ†æã€è‡ªåŠ¨å¤‡ä»½

### ğŸ’» å…³é”®APIæ¥å£
- `POST /api/analyze` - åˆ†ææ¥å£å‡çº§æ”¯æŒåˆ†çº§
- `GET /api/user-status` - ç”¨æˆ·çŠ¶æ€å’Œç­‰çº§æŸ¥è¯¢
- `POST /api/upgrade-intent` - å‡çº§æ„æ„¿æ”¶é›†
- `GET /api/analytics-dashboard` - æ•°æ®åˆ†æä»ªè¡¨æ¿

### ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ
- **å¼€å‘ç¯å¢ƒ**ï¼šæœ¬åœ°é…ç½®ç®€åŒ–ï¼Œç¯å¢ƒå˜é‡æ¨¡æ¿
- **ç”Ÿäº§éƒ¨ç½²**ï¼šDockerå®¹å™¨åŒ–ï¼Œnginxåå‘ä»£ç†
- **CI/CDæµç¨‹**ï¼šGitHub Actionsè‡ªåŠ¨åŒ–éƒ¨ç½²
- **ç›‘æ§è¿ç»´**ï¼šæ—¥å¿—ç®¡ç†ã€æ€§èƒ½ç›‘æ§ã€å¤‡ä»½æ¢å¤

### âœ… éªŒè¯æœŸç‰¹è‰²åŠŸèƒ½
- **ä¼ªä»˜è´¹ä½“éªŒ**ï¼šå®Œæ•´ä»˜è´¹æµç¨‹ä½†ä¸å®é™…æ”¶è´¹
- **æ•°æ®æ”¶é›†**ï¼šä»˜è´¹æ„æ„¿ã€ç”¨æˆ·è¡Œä¸ºã€è½¬åŒ–åˆ†æ
- **A/Bæµ‹è¯•**ï¼šå‡çº§æ–‡æ¡ˆã€å®šä»·å±•ç¤ºä¼˜åŒ–
- **ä¸´æ—¶æƒé™**ï¼š24å°æ—¶é«˜çº§åŠŸèƒ½ä½“éªŒ

**è¯¥æŠ€æœ¯æ–¹æ¡ˆä¸º3æ¡£äº§å“éªŒè¯å’Œå•†ä¸šåŒ–æä¾›äº†å®Œæ•´çš„æŠ€æœ¯æ”¯æ’‘ï¼**

*ã€æŠ€æœ¯å®ç°æ–¹æ¡ˆæ–‡æ¡£å·²å®Œæˆã€‘*